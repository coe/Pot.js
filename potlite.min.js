/*!
 * Pot.js - JavaScript utility library (lite)
 *
 * Pot.js implements practical tendency as a substitution utility library.
 * That includes asynchronous methods as "Deferred"
 *  for solution to heavy process.
 * That is fully ECMAScript compliant.
 *
 * Version 1.17, 2011-10-29
 * Copyright (c) 2011 polygon planet <polygon.planet@gmail.com>
 * Dual licensed under the MIT and GPL v2 licenses.
 */
(function(globals,undefined){var Pot={VERSION:"1.17",TYPE:"lite"},slice=Array.prototype.slice,concat=Array.prototype.concat,toString=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty,RE_ARRAYLIKE=/List|Collection/i,RE_TRIM=/^[\s\u00A0\u3000]+|[\s\u00A0\u3000]+$/g,RE_RESCAPE=/([-.*+?^${}()|[\]\/\\])/g,RE_PERCENT_ENCODED=/^(?:[a-zA-Z0-9_~.-]|%[0-9a-fA-F]{2})*$/,Ci,Cc,Cr,Cu;
(function(nv){update(Pot,{NAME:"Pot",System:{},toString:function(){return buildObjectString(this.NAME||this.name||typeof this)
},Browser:(function(n){var r={},u,m,ua,ver,re,rs,i,len;re={webkit:/(webkit)(?:.*version|)[\s\/]+([\w.]+)/,opera:/(opera)(?:.*version|)[\s\/]+([\w.]+)/,msie:/(msie)[\s\/]+([\w.]+)/,mozilla:/(?!^.*compatible.*$).*(mozilla)(?:.*?\s+rv[:\s\/]+([\w.]+)|)/};
rs=[/webkit.*(chrome)[\s\/]+([\w.]+)/,/webkit.*version[\s\/]+([\w.]+).*(safari)/,/webkit.*(safari)[\s\/]+([\w.]+)/,/(iphone).*version[\s\/]+([\w.]+)/,/(ipod).*version[\s\/]+([\w.]+)/,/(ipad).*version[\s\/]+([\w.]+)/,/(android).*version[\s\/]+([\w.]+)/,/(blackberry)(?:[\s\d]*|.*version)[\s\/]+([\w.]+)/,re.webkit,re.opera,re.msie,/(?!^.*compatible.*$).*mozilla.*?(firefox)(?:[\s\/]+([\w.]+)|)/,re.mozilla];
u=String(n&&n.userAgent).toLowerCase();if(u){for(i=0,len=rs.length;i<len;i++){if((m=rs[i].exec(u))){break
}}if(m){if(/[^a-z]/.test(m[1])){ua=m[2];ver=m[1]}else{ua=m[1];ver=m[2]}if(ua){r[ua]={version:String(ver||0)}
}}m=re.webkit.exec(u)||re.opera.exec(u)||re.msie.exec(u)||re.mozilla.exec(u)||[];
if(m&&m[1]){r[m[1]]={version:String(m[2]||0)}}}return r})(nv),LANG:(function(n){return((n&&(n.language||n.userLanguage||n.browserLanguage||n.systemLanguage))||"en").split(/[^a-zA-Z0-9]+/).shift().toLowerCase()
})(nv),OS:(function(nv){var r={},n=nv||{},pf,ua,av,maps,i,len,o;pf=String(n.platform).toLowerCase();
ua=String(n.userAgent).toLowerCase();av=String(n.appVersion).toLowerCase();maps=[{s:"iphone",p:pf},{s:"ipod",p:pf},{s:"ipad",p:ua},{s:"blackberry",p:ua},{s:"android",p:ua},{s:"mac",p:pf},{s:"win",p:pf},{s:"linux",p:pf},{s:"x11",p:av}];
for(i=0,len=maps.length;i<len;i++){o=maps[i];if(~o.p.indexOf(o.s)){r[o.s]=true}}if(r.android&&!~ua.indexOf("mobile")){r.androidtablet=true
}if(r.ipad||r.androidtablet){r.tablet=true}r.toString=function(){var s=[],p;for(p in r){if(r[p]===true){s.push(p)
}}return s.join("/")};return r})(nv),Global:(function(){if(!globals||typeof globals!=="object"||!("setTimeout" in globals)){globals=this||{}
}return this||{}})(),noop:function(){},tmp:{},Internal:{getMagicNumber:update(function(){var me=arguments.callee;
return me.INITIAL_NUMBER+(me.count++)},{count:0,INITIAL_NUMBER:Number("0xC26BEB642C0A")||(2147483647^2047)}),getExportObject:function(forGlobalScope){var outputs;
if(forGlobalScope){if(Pot.System.isNonBrowser){outputs=Pot.Global||globals}else{outputs=(Pot.isWindow(globals)&&globals)||(Pot.isWindow(Pot.Global)&&Pot.Global)
}if(!outputs&&typeof window!=="undefined"&&Pot.isWindow(window)){outputs=window}}if(!outputs){if(Pot.System.isNodeJS){if(typeof module==="object"&&typeof module.exports==="object"){outputs=module.exports
}else{if(typeof exports==="object"){outputs=exports}else{outputs=globals}}}else{outputs=globals
}if(!outputs){outputs=globals||Pot.Global}}return outputs}},update:update})})(typeof navigator!=="undefined"&&navigator||{});
update(Pot.System,(function(){var o={},g;o.isWaitable=false;if(typeof window==="object"&&"setTimeout" in window&&window.window==window&&typeof document==="object"&&document.nodeType>0&&typeof document.documentElement==="object"){o.isWebBrowser=true;
if(window.location&&/^(?:chrome|resource):?$/.test(window.location.protocol)){try{if(typeof Components!=="object"){throw false
}Cc=Components.classes;Ci=Components.interfaces;Cr=Components.results;Cu=Components.utils;
o.isWaitable=true;o.hasComponents=true;if(Pot.Browser.firefox||Pot.Browser.mozilla){o.isFirefoxExtension=true
}}catch(e){Ci=Cc=Cr=Cu=null}}}else{o.isNonBrowser=true;if(typeof process!=="undefined"&&process&&process.version&&typeof require==="function"&&(typeof exports==="object"||(typeof module==="object"&&typeof module.exports==="object"))){o.isNodeJS=true
}}if(Pot.Global&&Pot.Global.ActiveXObject||typeof ActiveXObject!=="undefined"&&(ActiveXObject)){o.hasActiveXObject=true
}if(!o.isFirefoxExtension){if(Pot.Browser.chrome||Pot.Browser.webkit||Pot.Browser.safari){if(typeof chrome==="object"&&typeof chrome.extension==="object"){o.isChromeExtension=true
}else{if(typeof safari==="object"&&typeof safari.extension==="object"){o.isSafariExtension=true
}}}}if(!o.isChromeExtension&&!o.isSafariExtension){if(typeof GM_log==="function"&&typeof GM_xmlhttpRequest==="function"){o.isGreasemonkey=true
}else{if(typeof require==="function"){try{if("title" in require("windows").browserWindows.activeWindow){o.isJetpack=true
}}catch(e){}}}}try{g=(function(){yield(0)})();if(g&&typeof g.next==="function"){o.isYieldable=true
}}catch(e){}return o})());(function(types){var i,len,typeMaps={};for(i=0,len=types.length;
i<len;i++){(function(){var type=types[i],low=type.toLowerCase();typeMaps[buildObjectString(type)]=low;
Pot["is"+type]=(function(){switch(low){case"error":return function(o){return(o&&(o instanceof Error||Pot.typeOf(o)===low))||false
};case"date":return function(o){return(o&&(o instanceof Date||Pot.typeOf(o)===low))||false
};default:return function(o){return Pot.typeOf(o)===low}}})()})()}Pot.update({typeOf:function(o){return(o==null)?String(o):(typeMaps[toString.call(o)]||"object")
},typeLikeOf:function(o){var type=Pot.typeOf(o);if(type!=="array"&&Pot.isArrayLike(o)){type="array"
}return type}})})("Boolean Number String Function Array Date RegExp Object Error".split(" "));
(function(SI){update(Pot.Internal,{callInBackground:{flush:function(callback){var handler=this.byEvent||this.byTick||this.byTimer;
handler(callback)},byEvent:(function(){var IMAGE;if(Pot.System.isNonBrowser||Pot.System.isNodeJS||typeof window!=="object"||typeof document!=="object"||typeof Image!=="function"||window.opera||Pot.Browser.opera||typeof document.addEventListener!=="function"){return false
}try{if(typeof(new Image()).addEventListener!=="function"){return false}}catch(e){return false
}IMAGE="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";
return function(callback){var done,img,handler;img=new Image();handler=function(){try{img.removeEventListener("load",handler,false);
img.removeEventListener("error",handler,false)}catch(e){}if(!done){done=true;callback()
}};img.addEventListener("load",handler,false);img.addEventListener("error",handler,false);
try{img.src=IMAGE}catch(e){this.byEvent=this.byTimer}}})(),byTick:(function(){if(!Pot.System.isNodeJS||typeof process!=="object"||typeof process.nextTick!=="function"){return false
}return function(callback){process.nextTick(callback)}})(),byTimer:function(callback,msec){return setTimeout(callback,msec||0)
}},setTimeout:function(func,msec){try{return Pot.Internal.callInBackground.byTimer(func,msec||0)
}catch(e){}},clearTimeout:function(id){try{return clearTimeout(id)}catch(e){}},setInterval:function(func,msec){try{return setInterval(func,msec||0)
}catch(e){}},clearInterval:function(id){try{return clearInterval(id)}catch(e){}}});
Pot.update({StopIteration:(function(){var StopIteration=function(){return StopIteration
};(function(s){s.NAME=SI;s.toString=Pot.toString;s.prototype={constructor:s,NAME:s.NAME,toString:s.toString};
s.prototype.constructor.prototype=s.constructor.prototype})(StopIteration);return new StopIteration()
})(),isStopIter:function(o){var result=false;try{if(Pot.StopIteration!==undefined&&(o==Pot.StopIteration||o instanceof Pot.StopIteration)){result=true
}else{if(typeof StopIteration!=="undefined"&&(o==StopIteration||o instanceof StopIteration)){result=true
}else{if(this&&this.StopIteration!==undefined&&(o==this.StopIteration||o instanceof this.StopIteration)){result=true
}else{if(~toString.call(o).indexOf(SI)||~String(o&&o.toString&&o.toString()||o).indexOf(SI)){result=true
}}}}}catch(e){result=false}return result},isIterable:function(x){return !!(x&&Pot.isFunction(x.next)&&(~x.next.toString().indexOf(SI)||Pot.isNativeCode(x.next)))
},isArrayLike:function(o){var len;if(!o){return false}if(Pot.isArray(o)||o instanceof Array||o.constructor===Array){return true
}len=o.length;if(!Pot.isNumber(len)||(!Pot.isObject(o)&&!Pot.isArray(o))||o===Pot||o===Pot.Global||o===globals||Pot.isWindow(o)||Pot.isDocument(o)||Pot.isElement(o)){return false
}if(o.isArray||Pot.isFunction(o.callee)||Pot.isNodeList(o)||((typeof o.item==="function"||typeof o.nextNode==="function")&&o.nodeType!=3&&o.nodeType!=4)||(0 in o&&((len-1) in o))||RE_ARRAYLIKE.test(toString.call(o))){return true
}else{return false}},isDeferred:function(x){return x!=null&&((x instanceof Pot.Deferred)||(x.id!=null&&x.id===Pot.Deferred.prototype.id&&x.NAME!=null&&x.NAME===Pot.Deferred.prototype.NAME))
},isIter:function(x){return x!=null&&((x instanceof Pot.Iter)||(x.id!=null&&x.id===Pot.Iter.prototype.id&&x.NAME!=null&&x.NAME===Pot.Iter.prototype.NAME&&typeof x.next==="function"))
},isPercentEncoded:function(s){return RE_PERCENT_ENCODED.test(s)},isNumeric:function(n){return(n==null||(n===""||(n==""&&n&&n.constructor===String))||(typeof n==="object"&&n.constructor!==Number))?false:!isNaN(n-0)
},isInt:function(n){return Pot.isNumber(n)&&isFinite(n)&&n%1==0},isNativeCode:function(method){var code;
if(!method){return false}code=method.toString();return !!(~code.indexOf("[native code]")&&code.length<=92)
},isBuiltinMethod:function(method){return method!=null&&(typeof method==="function"||method.constructor===Function)&&Pot.isNativeCode(method)
},isWindow:function(x){return x!=null&&typeof x==="object"&&"setInterval" in x&&x.window==x&&!!(x.location||x.screen||x.navigator||x.document)
},isDocument:function(x){return x!=null&&typeof x==="object"&&"getElementById" in x&&x.nodeType>0&&typeof x.documentElement==="object"
},isElement:function(x){return x!=null&&typeof x==="object"&&x.nodeType==1},isNodeLike:function(x){return x!=null&&typeof x==="object"&&x.nodeType>0
},isNodeList:function(x){var type;if(x&&Pot.isNumber(x.length)){type=typeof x.item;
if(Pot.isObject(x)){return type==="function"||type==="string"}else{if(Pot.isFunction(x)){return type==="function"
}}}return false}})})("StopIteration");if(typeof StopIteration==="undefined"){var StopIteration=Pot.StopIteration
}update(Pot.System,{isBuiltinObjectKeys:Pot.isBuiltinMethod(Object.keys),isBuiltinArrayForEach:Pot.isBuiltinMethod(Array.prototype.forEach),isBuiltinArrayIndexOf:Pot.isBuiltinMethod(Array.prototype.indexOf),isBuiltinArrayLastIndexOf:Pot.isBuiltinMethod(Array.prototype.lastIndexOf)});
Pot.update({globalEval:update(function(code){var me=arguments.callee,language,id,scope,func,doc,script;
if(code&&me.patterns.valid.test(code)){if(Pot.System.hasActiveXObject){if(typeof execScript!=="undefined"&&execScript&&me.test(execScript)){return execScript(code,me.language)
}else{func="execScript";if(func in Pot.Global&&me.test(func,Pot.Global)){return Pot.Global[func](code,me.language)
}else{if(func in globals&&me.test(func,globals)){return globals[func](code,me.language)
}}}}if(Pot.System.isGreasemonkey){return Pot.localEval.doEval(code)}func="eval";if(func in Pot.Global&&me.test(func,Pot.Global)){scope=Pot.Global
}else{if(func in globals&&me.test(func,globals)){scope=globals}}if(scope){if(scope[func].call&&scope[func].apply){return scope[func].call(scope,code)
}if(me.worksForGlobal==null){me.worksForGlobal=false;do{id=buildSerial(Pot,"")}while(id in scope);
scope[func]("var "+id+"=1;");if(id in scope&&scope[id]===1){me.worksForGlobal=true
}delete scope[id]}if(me.worksForGlobal){return scope[func](code)}}if(Pot.System.isWebBrowser&&typeof document==="object"&&document.body){doc=document;
script=doc.createElement("script");script.type="text/javascript";script.defer=false;
script.appendChild(doc.createTextNode(code));doc.body.appendChild(script);doc.body.removeChild(script)
}else{return(new Function(code))()}}},{language:"JavaScript",patterns:{valid:/\S/},test:function(func,obj){var result=false,nop="(void 0);";
try{if(obj){obj[func](nop)}else{func(nop)}result=true}catch(e){result=false}return result
}}),localEval:update(function(code){var that=Pot.globalEval,me=arguments.callee,src;
if(code&&that.patterns.valid.test(code)){if(typeof eval!=="undefined"){return me.doEval(code)
}else{if(me.isLiteral.test(code)&&!me.hasReturn.test(code)){src="return("+String(code).replace(me.clean,"")+");"
}else{src=code}return(new Function("return(function(){"+src+"})();"))()}}},{isLiteral:/^\s*(?!(?:return|var|if|do|for|try|while)\b\s*)[\w$.!"'~(){}[\]]/,hasReturn:/\breturn\b(?![\s\S]*\breturn\b[\s\S]*$)[\s\S]*$/,clean:/^(?:[{[(']{0}[')\]}]+|)[;\s\u00A0]*|[;\s\u00A0]*$/g,doEval:function(){return eval(arguments[0])
}})});function update(){var args=arguments,len=args.length,i=1,o,p,x;if(len===i){o=this||{};
i--}else{o=args[i-1]}if(o){do{x=args[i];if(x){for(p in x){try{o[p]=x[p]}catch(e){}}}}while(++i<len)
}return o}function arrayize(object,index){var array,i,len,me=arguments.callee,t;if(me.canNodeList==null){if(globals||Pot.Global){try{t=slice.call(((globals&&(globals.documentElement||(globals.document&&globals.document.documentElement)||(globals.content&&globals.content.document&&globals.content.document.documentElement)))||(Pot.Global&&(Pot.Global.documentElement||(Pot.Global.document&&Pot.Global.document.documentElement)||(Pot.Global.content&&Pot.Global.content.document&&Pot.Global.content.document.documentElement)))||(typeof document==="object"&&document.documentElement)).childNodes)[0].nodeType;
t=null;me.canNodeList=true}catch(e){me.canNodeList=false}}}if(object==null){array=[object]
}else{switch(Pot.typeOf(object)){case"array":array=object.slice();break;case"object":if(Pot.isArrayLike(object)){if(!me.canNodeList&&Pot.isNodeList(object)){array=[];
i=0;len=object.length;do{array[i]=object[i]}while(++i<len)}else{array=slice.call(object)
}break}default:array=slice.call(concat.call([],object));break}}if(index>0){array=array.slice(index)
}return array}function now(){return(new Date()).getTime()}function stringify(x,ignoreBoolean){var result="",c,len=arguments.length;
if(x!==null){switch(typeof x){case"string":case"number":case"xml":result=x;break;
case"boolean":if(len>=2&&!ignoreBoolean){result=x}else{if(!ignoreBoolean){result=x?1:""
}}break;case"object":if(x){c=x.constructor;if(c===String||c===Number||(typeof XML!=="undefined"&&c===XML)||(typeof Buffer!=="undefined"&&c===Buffer)){result=x
}else{if(c===Boolean){if(len>=2&&!ignoreBoolean){result=x}else{if(!ignoreBoolean){result=(x==true)?1:""
}}}}}break;default:break}}return result.toString()}function trim(s,chars,ignoreCase){var re;
if(chars){re=new RegExp(["^[","]+|[","]+$"].join(rescape(chars)),"g"+(ignoreCase?"i":""))
}else{re=RE_TRIM}return stringify(s,true).replace(re,"")}function rescape(s){return stringify(s,true).replace(RE_RESCAPE,"\\$1")
}function invoke(){var args=arrayize(arguments),argn=args.length;var object,method,params,emit,p,t,i,len,err;
try{switch(argn){case 0:throw false;case 1:method=args[0];break;case 2:object=args[0];
method=args[1];break;case 3:object=args[0];method=args[1];params=arrayize(args[2]);
break;default:object=args[0];method=args[1];params=arrayize(args,2);break}if(!method){throw method
}if(!object&&Pot.isString(method)){object=(object&&object[method]&&object)||(globals&&globals[method]&&globals)||(Pot.Global&&Pot.Global[method]&&Pot.Global)
}if(Pot.isString(method)){emit=true;if(!object){object=(globals||Pot.Global)}}}catch(e){err=e;
throw Pot.isError(err)?err:new Error(err)}if(Pot.isFunction(method.apply)&&Pot.isFunction(method.call)){if(params==null||!params.length){return method.call(object)
}else{return method.apply(object,params)}}else{p=params||[];len=p.length||0;if(emit){switch(len){case 0:return object[method]();
case 1:return object[method](p[0]);case 2:return object[method](p[0],p[1]);case 3:return object[method](p[0],p[1],p[2]);
default:break}}else{switch(len){case 0:return method();case 1:return method(p[0]);
case 2:return method(p[0],p[1]);case 3:return method(p[0],p[1],p[2]);default:break
}}t=[];for(i=0;i<len;i++){t[t.length]="p["+i+"]"}return(new Function("e,o,m,p",["return e ? o[m](",") : m(",");"].join(t.join(","))))(emit,object,method,p)
}}function debug(msg){var args=arguments,me=args.callee,func,consoleService;try{if(!me.firebug("log",args)){if(!Pot.System.hasComponents){throw false
}consoleService=Cc["@mozilla.org/consoleservice;1"].getService(Ci.nsIConsoleService);
consoleService.logStringMessage(String(msg))}}catch(e){if(typeof GM_log!=="undefined"){func=GM_log
}else{if(typeof console!=="undefined"){func=console.debug||console.dir||console.log
}else{if(typeof opera!=="undefined"&&opera.postError){func=opera.postError}else{func=function(x){throw x
}}}}try{if(func.apply){func.apply(func,args)}else{throw func}}catch(e){try{func(msg)
}catch(e){try{console.log(msg)}catch(e){try{me.divConsole(msg)}catch(e){}}}}}return msg
}update(debug,{firebug:function(method,args){var result=false,win,fbConsole;try{if(!Pot.System.hasComponents){throw false
}win=Pot.XPCOM.getMostRecentWindow();if(!win){throw win}if(win.FirebugConsole&&win.FirebugContext){fbConsole=new win.FirebugConsole(win.FirebugContext,win.content);
fbConsole[method].apply(fbConsole,args);result=true}else{if(win.Firebug&&win.Firebug.Console){try{win.Firebug.Console.logFormatted.call(win.Firebug.Console,arrayize(args),win.FirebugContext,method);
result=true}catch(er){}}}}catch(e){}return result},divConsole:update(function(msg){var me=arguments.callee,ie6,doc,de,onResize,onScroll,onClick;
if(Pot.System.hasActiveXObject&&typeof document!=="undefined"){doc=document;de=doc.documentElement||{};
try{ie6=(typeof de.style.maxHeight==="undefined")}catch(e){}if(me.done&&me.ieConsole){me.append(msg)
}else{if(!me.msgStack){me.msgStack=[]}me.msgStack.push(msg);if(!me.done){me.done=true;
Pot.Deferred.till(function(){return !!(doc&&doc.body)}).then(function(){var defStyle,style,close,wrapper;
defStyle={border:"1px solid #999",background:"#fff",color:"#333",fontSize:"13px",fontFamily:"monospace",position:"absolute",padding:"10px",margin:"0px"};
wrapper=doc.createElement("div");style=wrapper.style;each(defStyle,function(v,k){style[k]=v
});style.borderWidth="3px";style.width="95%";style.zIndex=9996;style.left="0px";style.bottom="0px";
if(ie6){style.height=Math.floor(de.clientHeight/3.2)+"px"}else{style.position="fixed";
style.height="25%"}me.ieConsole=wrapper.cloneNode(false);me.ieConsole.id=me.ieConsoleId=buildSerial(Pot,"");
style=me.ieConsole.style;style.borderWidth="1px";style.width="95%";style.height="87%";
style.position="relative";style.zIndex=9997;style.padding="5px";style.whiteSpace="pre";
style.wordWrap="break-word";style.overflowX="hidden";style.overflowY="auto";me.hr=doc.createElement("hr");
style=me.hr.style;style.position="static";style.width="100%";style.border="1px solid #aaa";
style.zIndex=9998;close=doc.createElement("div");style=close.style;each(defStyle,function(v,k){style[k]=v
});style.zIndex=9999;style.fontFamily="sans-serif";style.fontWeight="bold";style.borderWidth="1px";
style.padding="1px 4px";style.lineHeight=1;style.right="2px";style.top="2px";style.cursor="pointer";
close.title="close";close.innerHTML="x";onResize=function(){var width,height,def="95%";
width=doc.body.clientWidth-7;wrapper.style.width=(width<=0)?def:width+"px";width=wrapper.offsetWidth-55;
me.ieConsole.style.width=(width<=0)?def:width+"px";height=Math.floor(de.clientHeight/3.2)+"px";
wrapper.style.height=height;onScroll()};onScroll=function(){var pos=de.scrollTop+(de.clientHeight-wrapper.clientHeight)-7;
if(pos>0){wrapper.style.top=pos+"px"}};onClick=function(){try{wrapper.parentNode.removeChild(wrapper);
window.dettachEvent("onscroll",onScroll);window.dettachEvent("onresize",onResize);
wrapper=me.ieConsole=null}catch(e){}};if(typeof window!=="undefined"&&window&&window.attachEvent){if(ie6){each({onscroll:onScroll,onresize:onResize},function(f,k){window.attachEvent(k,f)
})}if(close.attachEvent){close.attachEvent("onclick",onClick)}}if(ie6){Pot.Deferred.wait(0.25).then(function(){wrapper.style.bottom="1px"
}).wait(0.5).then(function(){wrapper.style.bottom="0px"})}wrapper.appendChild(close);
wrapper.appendChild(me.ieConsole);doc.body.appendChild(wrapper);me.append()})}}}},{append:function(msg){var me=this,s,v,stack;
if(me.ieConsole){try{stack=arrayize(me.msgStack||[]);while(me.msgStack&&me.msgStack.length){me.msgStack.pop()
}if(arguments.length){stack.push(msg)}while(stack.length){v=stack.shift();if(v==null){s=String(v)
}else{s=v.toString?v.toString():toString.call(v)}each([document.createTextNode(s),me.hr.cloneNode(false)],function(node){me.ieConsole.appendChild(node)
})}Pot.Internal.setTimeout(function(){me.ieConsole.scrollTop=me.ieConsole.scrollHeight
},10)}catch(e){}}}})});Pot.update({arrayize:arrayize,stringify:stringify,trim:trim,rescape:rescape,invoke:invoke,debug:debug});
function each(object,callback,context){var i,len,val,err;if(object){len=object.length;
try{if(Pot.isArrayLike(object)){for(i=0;i<len;i++){if(i in object){try{val=object[i]
}catch(e){continue}callback.call(context,val,i,object)}}}else{for(i in object){try{val=object[i]
}catch(e){continue}callback.call(context,val,i,object)}}}catch(ex){err=ex;if(!Pot.isStopIter(err)){throw err
}}}return object}function buildSerial(o,sep){return[String((o&&(o.NAME||o.name))||(void 0)),Math.random().toString(36).substring(2),now()].join(arguments.length>=2?sep:"-")
}function buildObjectString(name){return"[object "+name+"]"}function extendDeferredOptions(o,x){var a,b;
if(o&&x){if(Pot.isObject(o.options)){a=o.options}else{if(Pot.isObject(o)){a=o}}if(Pot.isObject(x.options)){b=x.options
}else{if(Pot.isObject(x)){b=x}}if("async" in b){a.async=!!b.async}if("speed" in b&&Pot.isNumeric(b.speed)){a.speed=b.speed
}if("cancellers" in b){if(!b.cancellers||!b.cancellers.length){b.cancellers=[]}else{if(a.cancellers&&a.cancellers.length){a.cancellers=concat.call([],arrayize(a.cancellers),arrayize(b.cancellers))
}else{a.cancellers=arrayize(b.cancellers)}}}if("stoppers" in b){if(!b.stoppers||!b.stoppers.length){b.stoppers=[]
}else{if(a.stoppers&&a.stoppers.length){a.stoppers=concat.call([],arrayize(a.stoppers),arrayize(b.stoppers))
}else{a.stoppers=arrayize(b.stoppers)}}}if("storage" in b){a.storage=b.storage||{}
}if(!a.storage){a.storage={}}}}(function(){Pot.update({Deferred:function(){return Pot.isDeferred(this)?this.init(arguments):new Pot.Deferred.fn.init(arguments)
}});update(Pot.Deferred,{StopIteration:Pot.StopIteration,speeds:{limp:2400,doze:1000,slow:100,normal:36,fast:20,rapid:12,ninja:0},states:{success:1,failure:2,fired:3,unfired:4}});
each(Pot.Deferred.states,function(n,name){Pot.Deferred.states[n]=name});update(Pot.Deferred,{defaults:{speed:Pot.Deferred.speeds.ninja,canceller:null,stopper:null,async:true}});
Pot.Deferred.fn=Pot.Deferred.prototype=update(Pot.Deferred.prototype,{constructor:Pot.Deferred,id:Pot.Internal.getMagicNumber(),serial:null,chains:[],chained:false,cancelled:false,freezing:false,tilling:false,waiting:false,nested:0,state:null,results:null,destassign:false,chainDebris:null,options:{},plugins:{},NAME:"Deferred",toString:Pot.toString,isDeferred:Pot.isDeferred,init:function(args){if(!this.serial){this.serial=buildSerial(this)
}this.options={};this.plugins={};initOptions.call(this,arrayize(args),Pot.Deferred.defaults);
update(this,{results:{success:null,failure:null},state:Pot.Deferred.states.unfired,chains:[],nested:0,chained:false,cancelled:false,freezing:false,tilling:false,waiting:false,destassign:false,chainDebris:null});
Pot.Internal.referSpeeds.call(this,Pot.Deferred.speeds);return this},speed:function(sp){var that=this,args=arguments,value;
if(Pot.isNumeric(sp)){value=sp-0}else{if(Pot.isNumeric(Pot.Deferred.speeds[sp])){value=Pot.Deferred.speeds[sp]-0
}else{value=this.options.speed}}if(this.state===Pot.Deferred.states.unfired&&!this.chains.length){if(args.length===0){return this.options.speed
}this.options.speed=value}else{this.then(function(reply){if(args.length===0){return that.options.speed
}that.options.speed=value;return reply})}return this},async:function(sync){var that=this,args=arguments;
if(this.state===Pot.Deferred.states.unfired&&!this.chains.length){if(args.length===0){return this.options.async
}this.options.async=!!sync}else{this.then(function(reply){if(args.length===0){return that.options.async
}that.options.async=!!sync;return reply})}return this},canceller:function(func){var args=arguments;
if(this.state===Pot.Deferred.states.unfired&&!this.chains.length){if(args.length===0){return this.options.cancellers
}if(!this.cancelled&&Pot.isFunction(func)){this.options.cancellers.push(func)}}else{this.stopper.apply(this,args)
}return this},stopper:function(func){var that=this,args=arguments;if(this.state===Pot.Deferred.states.unfired&&!this.chains.length){this.canceller.apply(this,args)
}else{this.then(function(reply){if(args.length===0){return that.options.stoppers}if(!that.cancelled&&Pot.isFunction(func)){that.options.stoppers.push(func)
}return reply})}return this},then:function(callback,errback){if(!this.chained&&!this.cancelled){this.chains.push({success:callback,failure:errback});
if(this.state&Pot.Deferred.states.fired){if(!this.freezing&&!this.tilling&&!this.waiting){fire.call(this)
}}}Pot.Internal.referSpeeds.call(this,Pot.Deferred.speeds);return this},rescue:function(errback){return this.then(null,errback)
},ensure:function(callback){return this.then(callback,callback)},cancel:function(){if(!this.cancelled){this.cancelled=true;
switch(this.state){case Pot.Deferred.states.unfired:cancelize.call(this,"cancellers");
if(this.state===Pot.Deferred.states.unfired){this.raise(new Error(this))}break;case Pot.Deferred.states.success:cancelize.call(this,"stoppers");
if(Pot.isDeferred(this.results.success)){this.results.success.cancel()}break;case Pot.Deferred.states.failure:cancelize.call(this,"stoppers");
break;default:break}}return this},begin:function(){var that=this,arg,args=arrayize(arguments),value;
arg=args[0];if(args.length>1){value=args}else{value=args[0]}if(!this.cancelled&&this.state===Pot.Deferred.states.unfired){if(Pot.isDeferred(arg)&&!arg.cancelled){arg.ensure(function(){that.begin.apply(this,arguments)
})}else{this.options.cancellers=[];post.call(this,value)}}Pot.Internal.referSpeeds.call(this,Pot.Deferred.speeds);
return this},raise:function(){var args=arrayize(arguments),arg,value;arg=args[0];
if(!Pot.isError(arg)){args[0]=new Error(arg)}if(args.length>1){value=args}else{value=args[0]
}return this.begin.apply(this,arrayize(value))},end:function(){this.chained=true;
return this},wait:function(seconds,value){var d,that=this,args=arguments;d=new Pot.Deferred();
return this.then(function(reply){if(Pot.isError(reply)){throw reply}that.waiting=true;
Pot.Deferred.wait(seconds).ensure(function(result){that.waiting=false;if(Pot.isError(result)){d.raise(result)
}else{d.begin(args.length>=2?value:reply)}});return d})},till:function(cond){var that=this,d=new Pot.Deferred();
return this.then(function(reply){if(Pot.isError(reply)){throw reply}that.tilling=true;
Pot.Deferred.till(cond,reply).ensure(function(result){that.tilling=false;if(Pot.isError(result)){d.raise(result)
}else{d.begin(reply)}});return d})},args:function(){var a=arrayize(arguments),len=a.length;
if(len===0){return Pot.Deferred.lastResult(this)}else{return this.then(function(){var reply,reps=arrayize(arguments);
if(reps.length>1){reply=reps}else{reply=reps[0]}if(len>1){return a}else{if(Pot.isFunction(a[0])){return a[0].apply(this,arrayize(reply))
}else{return a[0]}}})}},data:function(){var that=this,result=this,args=arrayize(arguments);
var i,len=args.length,prefix=".";if(this.options){if(!this.options.storage){this.options.storage={}
}switch(len){case 0:result={};each(this.options.storage,function(val,key){try{if(key&&key.charAt(0)===prefix){result[key.substring(1)]=val
}}catch(e){}});break;case 1:if(args[0]==null){this.options.storage={}}else{if(Pot.isObject(args[0])){each(args[0],function(val,key){that.options.storage[prefix+stringify(key)]=val
})}else{result=this.options.storage[prefix+stringify(args[0])]}}break;case 2:this.options.storage[prefix+stringify(args[0])]=args[1];
break;default:i=0;do{this.options.storage[prefix+stringify(args[i++])]=args[i++]}while(i<len);
break}}return result},update:function(){var that=Pot.Deferred.fn,args=arrayize(arguments);
args.unshift(that);update.apply(that,args);return this}});Pot.Deferred.prototype.init.prototype=Pot.Deferred.prototype;
function setState(value){if(Pot.isError(value)){this.state=Pot.Deferred.states.failure
}else{this.state=Pot.Deferred.states.success}return this.state}function post(value){setState.call(this,value);
this.results[Pot.Deferred.states[this.state]]=value;if(!this.freezing&&!this.tilling&&!this.waiting){fire.call(this)
}}function fire(force){if(force||(!this.freezing&&!this.tilling&&!this.waiting)){if(this.options&&this.options.async){fireAsync.call(this)
}else{fireSync.call(this)}}}function fireAsync(){var that=this,speed,callback;if(this.options&&Pot.isNumeric(this.options.speed)){speed=this.options.speed
}else{speed=Pot.Deferred.defaults.speed}this.freezing=true;callback=function(){try{fireProcedure.call(that)
}catch(e){that.freezing=false;throw e}if(chainsEnabled.call(that)){fire.call(that,true)
}else{that.freezing=false}};if(!speed&&this.state===Pot.Deferred.states.unfired){Pot.Internal.callInBackground.flush(callback)
}else{Pot.Internal.setTimeout(callback,speed)}}function fireSync(){fireProcedure.call(this);
if(this.options&&this.options.async){fire.call(this)}}function fireProcedure(){var that=this,result,callbacks,callback,nesting;
clearChainDebris.call(this);result=this.results[Pot.Deferred.states[this.state]];
nesting=null;while(chainsEnabled.call(this)){callbacks=this.chains.shift();callback=callbacks&&callbacks[Pot.Deferred.states[this.state]];
if(!Pot.isFunction(callback)){continue}try{if(this.destassign||(Pot.isNumber(callback.length)&&callback.length>1&&Pot.isArray(result)&&result.length===callback.length)){result=callback.apply(this,result)
}else{result=callback.call(this,result)}this.destassign=false;this.state=setState.call({},result);
if(Pot.isDeferred(result)){nesting=function(result){return bush.call(that,result)
};this.nested++}}catch(e){this.destassign=false;this.state=Pot.Deferred.states.failure;
result=e;setChainDebris.call(this,result);if(!Pot.isError(result)){result=new Error(result)
}}if(this.options&&this.options.async){break}}this.results[Pot.Deferred.states[this.state]]=result;
if(nesting&&this.nested){result.ensure(nesting).end()}reserveChainDebris.call(this)
}function chainsEnabled(){return this.chains&&this.chains.length&&this.nested===0&&!this.cancelled
}function hasErrback(){var exists,i,len,key,chains,errback;key=Pot.Deferred.states[Pot.Deferred.states.failure];
chains=this.chains;len=chains&&chains.length;if(len){for(i=0;i<len;i++){if(chains[i]){errback=chains[i][key];
if(errback&&Pot.isFunction(errback)){exists=true;break}}}}return exists}function setChainDebris(result){if(!hasErrback.call(this)){this.chainDebris={error:result}
}}function reserveChainDebris(){var that=this,speed;if(this.chainDebris&&"error" in this.chainDebris&&(this.cancelled||this.chained||(!this.chains||!this.chains.length))){if(this.options&&Pot.isNumeric(this.options.speed)){speed=this.options.speed
}else{speed=Pot.Deferred.defaults.speed}this.chainDebris.timerId=Pot.Internal.setTimeout(function(){throw that.chainDebris.error
},speed)}}function clearChainDebris(){if(this.chainDebris&&this.chainDebris.timerId!=null&&(this.state&Pot.Deferred.states.fired)&&hasErrback.call(this)){Pot.Internal.clearTimeout(this.chainDebris.timerId);
delete this.chainDebris.error;delete this.chainDebris.timerId;this.chainDebris=null
}}function bush(result){post.call(this,result);this.nested--;if(this.nested===0&&!this.cancelled&&(this.state&Pot.Deferred.states.fired)){fire.call(this)
}}function initOptions(args,defaults){var opts,speed,canceller,stopper,async,nop;
if(args){if(args.length===1&&args[0]&&Pot.isObject(args[0])){opts=args[0];if(opts.speed!==nop||opts.canceller!==nop||opts.async!==nop||opts.stopper!==nop){speed=opts.speed;
canceller=opts.canceller;stopper=opts.stopper;async=opts.async}else{speed=opts.options&&opts.options.speed;
canceller=opts.options&&opts.options.canceller;stopper=opts.options&&opts.options.stopper;
async=opts.options&&opts.options.async}}else{if(args.length===1&&args[0]&&Pot.isArray(args[0])){opts=args[0]
}else{opts=args}each(opts||[],function(opt){if(speed===nop&&Pot.isNumeric(opt)){speed=opt
}else{if(speed===nop&&Pot.isNumeric(Pot.Deferred.speeds[opt])){speed=Pot.Deferred.speeds[opt]
}else{if(canceller===nop&&Pot.isFunction(opt)){canceller=opt}else{if(async===nop&&Pot.isBoolean(opt)){async=opt
}else{if(stopper===nop&&canceller===nop&&Pot.isFunction(opt)){stopper=opt}}}}}})}}this.options=this.options||{};
this.options.storage=this.options.storage||{};if(!Pot.isArray(this.options.cancellers)){this.options.cancellers=[]
}if(!Pot.isArray(this.options.stoppers)){this.options.stoppers=[]}if(!Pot.isNumeric(speed)){if(this.options.speed!==nop&&Pot.isNumeric(this.options.speed)){speed=this.options.speed-0
}else{speed=defaults.speed}}if(!Pot.isFunction(canceller)){canceller=defaults.canceller
}if(!Pot.isFunction(stopper)){stopper=defaults.stopper}if(!Pot.isBoolean(async)){if(this.options.async!==nop&&Pot.isBoolean(this.options.async)){async=this.options.async
}else{async=defaults.async}}update(this.options,{speed:speed-0,async:async});if(Pot.isFunction(canceller)){this.options.cancellers.push(canceller)
}if(Pot.isFunction(stopper)){this.options.stoppers.push(stopper)}return this}function cancelize(type){var func;
while(this.options[type]&&this.options[type].length){func=this.options[type].shift();
if(Pot.isFunction(func)){func.call(this)}}}update(Pot.Deferred,{extendSpeeds:function(target,name,construct,speeds){var refers={},methods={};
var create=function(speedName,speed){return function(){var opts={},args=arguments,me=args.callee;
args=arrayize(args);initOptions.call(opts,args,{speed:speed,canceller:Pot.Deferred.defaults.canceller,stopper:Pot.Deferred.defaults.stopper,async:Pot.Deferred.defaults.async});
opts.speedName=speedName;args.unshift(opts);return construct.apply(me.instance,args)
}};each(speeds,function(val,key){methods[key]=create(key,val)});return update(target[name],methods)
}});update(Pot.Internal,{referSpeeds:update(function(speeds){var me=arguments.callee,prop,speed;
if(speeds&&this.forEach.fast.instance!==this){for(prop in me.props){if(prop in this&&this[prop]){for(speed in me.speeds){if(speed in speeds&&speed in this[prop]&&this[prop][speed]){this[prop][speed].instance=this
}}}}}},{props:{forEach:true,repeat:true,forEver:true,iterate:true,map:true,filter:true,reduce:true,every:true,some:true},speeds:{limp:0,doze:1,slow:2,normal:3,fast:4,rapid:5,ninja:6}})});
Pot.Deferred.extendSpeeds(Pot,"Deferred",function(options){return Pot.Deferred(options)
},Pot.Deferred.speeds)})();(function(){update(Pot.Deferred,{isDeferred:Pot.isDeferred,succeed:function(){var d=new Pot.Deferred();
d.begin.apply(d,arguments);return d},failure:function(){var d=new Pot.Deferred();
d.raise.apply(d,arguments);return d},wait:function(seconds,value){var timer,d=new Pot.Deferred({canceller:function(){try{Pot.Internal.clearTimeout(timer)
}catch(e){}}});if(arguments.length>=2){d.then(function(){return value})}timer=Pot.Internal.setTimeout(function(){d.begin()
},Math.floor(((seconds-0)||0)*1000));return d},callLater:function(seconds,callback){var args=arrayize(arguments,2);
return Pot.Deferred.wait(seconds).then(function(){if(Pot.isDeferred(callback)){return callback.begin.apply(callback,args)
}else{if(Pot.isFunction(callback)){return callback.apply(callback,args)}else{return callback
}}})},callLazy:function(callback){var args=arrayize(arguments,1);return Pot.Deferred.begin(function(){if(Pot.isDeferred(callback)){return callback.begin.apply(callback,args)
}else{if(Pot.isFunction(callback)){return callback.apply(callback,args)}else{return callback
}}})},maybeDeferred:function(x){var result;if(Pot.isDeferred(x)){if(Pot.Deferred.isFired(x)){result=x
}else{result=x.begin()}}else{if(Pot.isError(x)){result=Pot.Deferred.failure(x)}else{result=Pot.Deferred.succeed(x)
}}return result},isFired:function(deferred){return Pot.isDeferred(deferred)&&((deferred.state&Pot.Deferred.states.fired)!==0)
},lastResult:function(deferred,value){var result,args=arguments,key;if(Pot.isDeferred(deferred)){try{key=Pot.Deferred.states[Pot.Deferred.states.success];
if(args.length<=1){result=deferred.results[key]}else{deferred.results[key]=value;
result=deferred}}catch(e){}}return result},lastError:function(deferred,value){var result,args=arguments,key;
if(Pot.isDeferred(deferred)){try{key=Pot.Deferred.states[Pot.Deferred.states.failure];
if(args.length<=1){result=deferred.results[key]}else{if(!Pot.isError(value)){value=new Error(value)
}deferred.results[key]=value;result=deferred}}catch(e){}}return result},register:function(){var result,that=Pot.Deferred.fn,args=arrayize(arguments),methods;
result=0;methods=[];switch(args.length){case 0:break;case 1:if(Pot.isObject(args[0])){each(args[0],function(val,key){if(Pot.isFunction(val)&&Pot.isString(key)){methods.push([key,val])
}else{if(Pot.isFunction(key)&&Pot.isString(val)){methods.push([val,key])}}})}break;
case 2:default:if(Pot.isFunction(args[0])){methods.push([args[1],args[0]])}else{methods.push([args[0],args[1]])
}break}if(methods&&methods.length){each(methods,function(item){var subs={},name,func,method;
if(item&&item.length>=2&&Pot.isFunction(item[1])){name=stringify(item[0],true);func=item[1];
method=function(){var params={},a=arrayize(arguments);params.input=(a.length>1)?a:a[0];
return this.then(function(){var ar=arrayize(arguments);params.result=(ar.length>1)?ar:ar[0];
return func.apply(this,arrayize(params))})};subs[name]=method;update(that,subs);result++
}})}return result},unregister:function(){var result,that=Pot.Deferred.fn,args=arrayize(arguments),names;
result=0;if(args.length>1){names=args}else{names=args[0]}each(arrayize(names),function(name){try{delete that[name];
result++}catch(e){}});return result},deferrize:function(object,method){var args=arguments,func,context,err;
try{switch(args.length){case 0:throw false;case 1:func=object;break;case 2:default:if(Pot.isObject(method)){context=method;
func=object}else{func=method;context=object}break}if(!func){throw func}}catch(e){err=e;
throw (Pot.isError(err)?err:new Error(err))}return function(){var that=this,args=arrayize(arguments),d=new Pot.Deferred();
d.then(function(){var dd,result,params=[],done=false,error,isFired;isFired=Pot.Deferred.isFired;
dd=new Pot.Deferred();each(args,function(val){if(Pot.isFunction(val)){params.push(function(){var r,er;
try{r=val.apply(that,arguments)}catch(e){er=e;if(!isFired(dd)){dd.raise(er)}}finally{if(!isFired(dd)){dd.begin(r)
}}if(er!=null){throw er}return r});done=true}else{params[params.length]=val}});try{result=invoke(context,func,params)
}catch(e){error=e;if(!done&&!isFired(dd)){dd.raise(error)}}finally{if(!done&&!isFired(dd)){dd.begin(result)
}}if(error!=null){throw Pot.isError(error)?error:new Error(error)}return dd}).begin();
return d}},update:function(){var that=Pot.Deferred,args=arrayize(arguments);args.unshift(that);
return update.apply(that,args)}});update(Pot.Deferred,{begin:function(x){var d,args=arrayize(arguments,1),isCallable,value;
d=new Pot.Deferred();isCallable=(x&&Pot.isFunction(x));if(isCallable){d.then(function(){return x.apply(this,args)
})}else{value=x}Pot.Internal.callInBackground.flush(function(){d.begin(value)});return d
},flush:function(callback){var args=arrayize(arguments,1);return Pot.Deferred.begin(function(){if(Pot.isDeferred(callback)){return callback.begin.apply(callback,args)
}else{if(Pot.isFunction(callback)){return callback.apply(this,args)}else{return callback
}}})},till:function(cond){var d=new Pot.Deferred(),args=arrayize(arguments,1),interval=13;
return Pot.Deferred.begin(function(){var that=this,me=arguments.callee,time=now();
if(cond&&!cond.apply(this,args)){Pot.Internal.setTimeout(function(){me.call(that)
},interval+(now()-time))}else{d.begin()}return d})},parallel:function(deferredList){var result,args=arguments,d,deferreds,values,bounds;
if(args.length===0){result=Pot.Deferred.succeed()}else{if(args.length===1){if(Pot.isObject(deferredList)){deferreds=deferredList
}else{deferreds=arrayize(deferredList)}}else{deferreds=arrayize(args)}result=new Pot.Deferred({canceller:function(){each(deferreds,function(deferred){if(Pot.isDeferred(deferred)){deferred.cancel()
}})}});d=new Pot.Deferred();bounds=[];values=Pot.isObject(deferreds)?{}:[];each(deferreds,function(deferred,key){var defer;
if(Pot.isDeferred(deferred)){defer=deferred}else{if(Pot.isFunction(deferred)){defer=new Pot.Deferred();
defer.then(function(){var r=deferred();if(Pot.isDeferred(r)&&r.state===Pot.Deferred.states.unfired){r.begin()
}return r})}else{defer=Pot.Deferred.succeed(deferred)}}if(!Pot.isDeferred(defer)){defer=Pot.Deferred.maybeDeferred(defer)
}bounds[bounds.length]=key;d.then(function(){if(defer.state===Pot.Deferred.states.unfired){Pot.Deferred.callLazy(defer)
}defer.then(function(value){values[key]=value;bounds.pop();if(bounds.length===0){result.begin(values)
}},function(err){result.raise(err)})})});Pot.Deferred.callLazy(d)}return result},chain:function(){var args=arguments,len=args.length,chains,chain,re;
chain=new Pot.Deferred();if(len>0){chains=arrayize(len===1?args[0]:args);re={name:/^\s*[()]*\s*function\s*([^\s()]+)/,rescue:/rescue|raise|err|fail/i};
each(chains,function(o){var name;if(Pot.isFunction(o)){try{name=o.toString().match(re.name)[1]
}catch(e){}if(name&&re.rescue.test(name)){chain.rescue(o)}else{chain.then(o)}}else{if(Pot.isDeferred(o)){chain.then(function(v){if(o.state===Pot.Deferred.states.unfired){o.begin(v)
}return o})}else{if(Pot.isObject(o)||Pot.isArray(o)){chain.then(function(){return Pot.Deferred.parallel(o)
})}else{if(Pot.isError(o)){chain.then(function(){throw o})}else{chain.then(function(){return o
})}}}}})}Pot.Deferred.callLazy(chain);return chain}});Pot.Deferred.extendSpeeds(Pot.Deferred,"begin",function(opts,x){var d,timer,args=arrayize(arguments,2),isCallable,op,speed,value;
isCallable=(x&&Pot.isFunction(x));op=opts.options||opts||{};if(!op.cancellers){op.cancellers=[]
}op.cancellers.push(function(){try{if(timer!=null){Pot.Internal.clearTimeout(timer)
}}catch(e){}});d=new Pot.Deferred(op);if(isCallable){d.then(function(){return x.apply(this,args)
})}else{value=x}speed=(((opts.options&&opts.options.speed)||opts.speed)-0)||0;if(Pot.isNumeric(speed)&&speed>0){timer=Pot.Internal.setTimeout(function(){d.begin(value)
},speed)}else{Pot.Internal.callInBackground.flush(function(){d.begin(value)})}return d
},Pot.Deferred.speeds);Pot.Deferred.extendSpeeds(Pot.Deferred,"flush",function(opts,callback){var speed,name,method,args=arrayize(arguments,2);
speed=opts.options?opts.options.speed:opts.speed;if(speed in Pot.Deferred.speeds&&Pot.isString(Pot.Deferred.speeds[speed])){name=Pot.Deferred.speeds[speed]
}else{each(Pot.Deferred.speeds,function(val,key){if(val==speed){name=key;throw Pot.StopIteration
}})}if(name&&name in Pot.Deferred.begin){method=Pot.Deferred.begin[name]}else{method=Pot.Deferred.begin
}return method(function(){if(Pot.isDeferred(callback)){return callback.begin.apply(callback,args)
}else{if(Pot.isFunction(callback)){return callback.apply(this,args)}else{return callback
}}})},Pot.Deferred.speeds)})();update(Pot.Internal,{LightIterator:update(function(object,callback,options){return new Pot.Internal.LightIterator.prototype.doit(object,callback,options)
},{speeds:{limp:-1,doze:0,slow:2,normal:5,fast:12,rapid:36,ninja:60},delays:{limp:1000,doze:100,slow:13,normal:0,fast:0,rapid:0,ninja:0},types:{forLoop:1,forInLoop:2,repeat:4,forEver:8,iterate:16}})});
update(Pot.Internal.LightIterator,{defaults:{speed:Pot.Internal.LightIterator.speeds.normal},revSpeeds:{}});
each(Pot.Internal.LightIterator.speeds,function(v,k){Pot.Internal.LightIterator.revSpeeds[v]=k
});Pot.Internal.LightIterator.fn=Pot.Internal.LightIterator.prototype=update(Pot.Internal.LightIterator.prototype,{constructor:Pot.Internal.LightIterator,interval:Pot.Internal.LightIterator.defaults.speed,iter:null,result:null,deferred:null,revDeferred:null,time:{},waiting:false,restable:false,async:false,options:null,doit:function(object,callback,options){this.setOptions(options);
this.execute(object,callback);this.watch();return this},setOptions:function(options){this.options=options||{};
this.setInterval();this.setAsync()},setInterval:function(){var n=null;if(Pot.isNumeric(this.options.interval)){n=this.options.interval-0
}else{if(this.options.interval in Pot.Internal.LightIterator.speeds){n=Pot.Internal.LightIterator.speeds[this.options.interval]-0
}}if(n!==null&&!isNaN(n)){this.interval=n}if(!Pot.isNumeric(this.interval)){this.interval=Pot.Internal.LightIterator.defaults.speed
}},setAsync:function(){var a=null;if(this.options.async!==undefined){a=!!this.options.async
}if(a!==null){this.async=!!a}if(!Pot.isBoolean(this.async)){this.async=!!this.async
}},createDeferred:function(){return new Pot.Deferred({async:false})},watch:function(){var that=this;
if(!this.async&&this.waiting===true){if(Pot.System.isWaitable){Pot.XPCOM.throughout(function(){return that.waiting!==true
})}else{throw new Error("Failed to synchronize loop")}}},execute:function(object,callback){var d,that=this;
this.waiting=true;if(!object){this.result={};this.waiting=false}else{this.waiting=true;
this.restable=true;this.time={start:now(),total:null,loop:null,diff:null,risk:null,axis:null,count:1,rest:100,limit:255};
this.setIter(object,callback);if(!this.async&&!Pot.System.isWaitable){this.revback();
this.waiting=false}else{d=this.createDeferred();d.then(function(){var d1,d2;d1=that.createDeferred();
d2=that.createDeferred();d1.then(function(){return that.revolve().then(function(){d2.begin()
})}).begin();return d2}).ensure(function(){that.waiting=false});if(this.async){this.deferred=d.then(function(){return that.result
})}this.flush(d)}}},setIter:function(object,callback){var type,types,context;type=this.options.type;
types=Pot.Internal.LightIterator.types;context=this.options.context;if((type&types.iterate)===types.iterate){this.result=null;
this.iter=this.iterate(object,callback,context)}else{if((type&types.forEver)===types.forEver){this.result={};
this.iter=this.forEver(object,context)}else{if((type&types.repeat)===types.repeat){this.result={};
this.iter=this.repeat(object,callback,context)}else{if(Pot.isArrayLike(object)){this.result=object;
this.iter=this.forLoop(object,callback,context)}else{this.result=object;this.iter=this.forInLoop(object,callback,context)
}}}}},revback:function(){var that=this,result,err,cutback=false,time;this.time.loop=now();
REVOLVE:{do{try{result=this.iter.next()}catch(e){err=e;if(Pot.isStopIter(err)){break REVOLVE
}throw err}if(this.async&&Pot.isDeferred(result)){return result.ensure(function(res){if(Pot.isError(res)){Pot.Deferred.lastError(this,res)
}else{Pot.Deferred.lastResult(this,res)}that.flush(that.revback,true)})}time=now();
if(Pot.System.isWaitable){if(this.time.total===null){this.time.total=time}else{if(time-this.time.total>=this.time.rest){Pot.XPCOM.throughout(0);
this.time.total=now()}}}else{if(!this.async){if(this.restable&&this.time.count>=this.time.limit){this.restable=false
}}}this.time.risk=time-this.time.start;this.time.diff=time-this.time.loop;if(this.time.diff>=this.interval){if(this.async&&this.interval<Pot.Internal.LightIterator.speeds.normal){cutback=true
}else{if(this.async||this.restable||Pot.System.isWaitable){if(this.time.diff<this.interval+8){this.time.axis=2
}else{if(this.time.diff<this.interval+36){this.time.axis=5}else{if(this.time.diff<this.interval+48){this.time.axis=7
}else{this.time.axis=10}}}if(this.time.axis>=10||(Math.random()*10<this.time.axis)){cutback=true
}}}}}while(!cutback);if(this.time.count<=this.time.limit){this.time.count++}return this.flush(this.revback,true)
}if(Pot.isDeferred(this.revDeferred)){this.revDeferred.begin()}},revolve:function(){var that=this,d,de;
d=this.createDeferred();de=this.createDeferred();d.then(function(){var dd=that.createDeferred();
that.revDeferred=that.createDeferred();dd.then(function(){return that.revback()}).begin();
return that.revDeferred}).ensure(function(er){de.begin();if(Pot.isError(er)){throw er
}});this.flush(d);return de},flush:function(callback,useSpeed){var that=this,d,lazy=false,speed,speedKey;
if(this.async||Pot.System.isWaitable){lazy=true}if(!lazy&&Pot.isFunction(callback)){return callback.call(this)
}else{d=this.createDeferred();d.then(function(){if(Pot.isDeferred(callback)){callback.begin()
}else{callback.call(that)}});if(lazy){speed=0;if(useSpeed){speedKey=Pot.Internal.LightIterator.revSpeeds[this.interval];
if(speedKey&&Pot.isNumeric(Pot.Internal.LightIterator.delays[speedKey])){speed=Pot.Internal.LightIterator.delays[speedKey]
}if(Math.random()*10<Math.max(2,(this.time.axis||2)/2.75)){speed+=Math.min(this.time.rest,Math.max(1,Math.ceil((this.time.risk/(this.time.rest+this.time.diff))+this.time.diff)))
}}Pot.Internal.setTimeout(function(){d.begin()},speed)}else{d.begin()}return void 0
}},noop:function(){return{next:function(){throw Pot.StopIteration}}},forEver:function(callback,context){var i=0;
if(!Pot.isFunction(callback)){return this.noop()}return{next:function(){var result=callback.call(context,i);
try{if(!isFinite(++i)||i>=Number.MAX_VALUE){throw 0}}catch(ex){i=0}return result}}
},repeat:function(max,callback,context){var i,loops,n,last;if(!Pot.isFunction(callback)){return this.noop()
}if(!max||max==null){n=0}else{if(Pot.isNumeric(max)){n=max-0}else{n=max||{};if(Pot.isNumeric(n.start)){n.begin=n.start
}if(Pot.isNumeric(n.stop)){n.end=n.stop}}}loops={begin:Pot.isNumeric(n.begin)?n.begin-0:0,end:Pot.isNumeric(n.end)?n.end-0:(n||0)-0,step:Pot.isNumeric(n.step)?n.step-0:1,last:false,prev:null};
i=loops.step?loops.begin:loops.end;last=loops.end-loops.step;return{next:function(){var result;
if(i<loops.end){loops.last=(i>=last);result=callback.call(context,i,loops.last,loops);
loops.prev=result}else{throw Pot.StopIteration}i+=loops.step;return result}}},forLoop:function(object,callback,context){var copy,i=0;
if(!object||!object.length||!Pot.isFunction(callback)){return this.noop()}copy=arrayize(object);
return{next:function(){var val,result;while(true){if(i>=copy.length){throw Pot.StopIteration
}if(!(i in copy)){i++;continue}try{val=copy[i]}catch(e){i++;continue}result=callback.call(context,val,i,object);
i++;return result}}}},forInLoop:function(object,callback,context){var copy,i=0,p,v,len;
if(Pot.isFunction(callback)){copy=[];for(p in object){try{v=object[p]}catch(e){continue
}copy[copy.length]=[v,p]}}if(!copy||!copy.length){return this.noop()}return{next:function(){var result,c,key,val;
while(true){if(i>=copy.length){throw Pot.StopIteration}if(!(i in copy)){i++;continue
}try{c=copy[i];val=c[0];key=c[1]}catch(e){i++;continue}result=callback.call(context,val,key,object);
i++;return result}}}},iterate:function(object,callback,context){var that=this,iterable;
if(Pot.isIterable(object)&&!Pot.isIter(object)){if(Pot.isFunction(callback)){return{next:function(){var res=object.next();
that.result=callback.apply(context,arrayize(res));return that.result}}}else{return{next:function(){that.result=object.next();
return that.result}}}}else{iterable=Pot.Iter.toIter(object);if(!Pot.isIter(iterable)){return this.noop()
}if(Pot.isFunction(callback)){return{next:function(){var results=iterable.next();
results=arrayize(results);while(results.length<2){results.push((void 0))}results.push(object);
that.result=callback.apply(context,results);return that.result}}}else{return{next:function(){that.result=iterable.next();
return that.result}}}}}});Pot.Internal.LightIterator.prototype.doit.prototype=Pot.Internal.LightIterator.prototype;
update(Pot.Internal.LightIterator,{QuickIteration:{resolve:function(iter){var err;
try{while(true){iter.next()}}catch(e){err=e;if(!Pot.isStopIter(err)){throw err}}},forEach:function(object,callback,context){var result,that,iter;
that=Pot.Internal.LightIterator.fn;if(!object){result={}}else{result=object;if(Pot.isArrayLike(object)){iter=that.forLoop(object,callback,context)
}else{iter=that.forInLoop(object,callback,context)}Pot.Internal.LightIterator.QuickIteration.resolve(iter)
}return result},repeat:function(max,callback,context){var result,that,iter;that=Pot.Internal.LightIterator.fn;
result={};if(max){iter=that.repeat(max,callback,context);Pot.Internal.LightIterator.QuickIteration.resolve(iter)
}return result},forEver:function(callback,context){var result,that,iter;that=Pot.Internal.LightIterator.fn;
result={};if(callback){iter=that.forEver(callback,context);Pot.Internal.LightIterator.QuickIteration.resolve(iter)
}return result},iterate:function(object,callback,context){var result,that,iter,o;
that=Pot.Internal.LightIterator.fn;if(!object){result={}}else{result=null;o={noop:that.noop,result:null};
iter=that.iterate.call(o,object,callback,context);Pot.Internal.LightIterator.QuickIteration.resolve(iter);
result=o.result}return result}}});update(Pot.tmp,{createLightIterateConstructor:function(creator){var methods,construct,name;
var create=function(speed){var interval;if(Pot.Internal.LightIterator.speeds[speed]===undefined){interval=Pot.Internal.LightIterator.defaults.speed
}else{interval=Pot.Internal.LightIterator.speeds[speed]}return creator(interval)};
construct=create();methods={};for(name in Pot.Internal.LightIterator.speeds){methods[name]=create(name)
}return update(construct,methods)}});Pot.update({forEach:Pot.tmp.createLightIterateConstructor(function(interval){if(Pot.System.isWaitable&&interval<Pot.Internal.LightIterator.speeds.normal){return function(object,callback,context){var opts={};
opts.type=Pot.Internal.LightIterator.types.forLoop|Pot.Internal.LightIterator.types.forInLoop;
opts.interval=interval;opts.async=false;opts.context=context;return(new Pot.Internal.LightIterator(object,callback,opts)).result
}}else{return function(object,callback,context){return Pot.Internal.LightIterator.QuickIteration.forEach(object,callback,context)
}}}),repeat:Pot.tmp.createLightIterateConstructor(function(interval){if(Pot.System.isWaitable&&interval<Pot.Internal.LightIterator.speeds.normal){return function(max,callback,context){var opts={};
opts.type=Pot.Internal.LightIterator.types.repeat;opts.interval=interval;opts.async=false;
opts.context=context;return(new Pot.Internal.LightIterator(max,callback,opts)).result
}}else{return function(max,callback,context){return Pot.Internal.LightIterator.QuickIteration.repeat(max,callback,context)
}}}),forEver:Pot.tmp.createLightIterateConstructor(function(interval){if(Pot.System.isWaitable&&interval<Pot.Internal.LightIterator.speeds.normal){return function(callback,context){var opts={};
opts.type=Pot.Internal.LightIterator.types.forEver;opts.interval=interval;opts.async=false;
opts.context=context;return(new Pot.Internal.LightIterator(callback,null,opts)).result
}}else{return function(callback,context){return Pot.Internal.LightIterator.QuickIteration.forEver(callback,context)
}}}),iterate:Pot.tmp.createLightIterateConstructor(function(interval){if(Pot.System.isWaitable&&interval<Pot.Internal.LightIterator.speeds.normal){return function(object,callback,context){var opts={};
opts.type=Pot.Internal.LightIterator.types.iterate;opts.interval=interval;opts.async=false;
opts.context=context;return(new Pot.Internal.LightIterator(object,callback,opts)).result
}}else{return function(object,callback,context){return Pot.Internal.LightIterator.QuickIteration.iterate(object,callback,context)
}}})});update(Pot.Deferred,{forEach:Pot.tmp.createLightIterateConstructor(function(interval){return function(object,callback,context){var opts={};
opts.type=Pot.Internal.LightIterator.types.forLoop|Pot.Internal.LightIterator.types.forInLoop;
opts.interval=interval;opts.async=true;opts.context=context;return(new Pot.Internal.LightIterator(object,callback,opts)).deferred
}}),repeat:Pot.tmp.createLightIterateConstructor(function(interval){return function(max,callback,context){var opts={};
opts.type=Pot.Internal.LightIterator.types.repeat;opts.interval=interval;opts.async=true;
opts.context=context;return(new Pot.Internal.LightIterator(max,callback,opts)).deferred
}}),forEver:Pot.tmp.createLightIterateConstructor(function(interval){return function(callback,context){var opts={};
opts.type=Pot.Internal.LightIterator.types.forEver;opts.interval=interval;opts.async=true;
opts.context=context;return(new Pot.Internal.LightIterator(callback,null,opts)).deferred
}}),iterate:Pot.tmp.createLightIterateConstructor(function(interval){return function(object,callback,context){var opts={};
opts.type=Pot.Internal.LightIterator.types.iterate;opts.interval=interval;opts.async=true;
opts.context=context;return(new Pot.Internal.LightIterator(object,callback,opts)).deferred
}})});delete Pot.tmp.createLightIterateConstructor;Pot.update({Iter:function(){return Pot.isIter(this)?this.init(arguments):new Pot.Iter.fn.init(arguments)
}});Pot.Iter.fn=Pot.Iter.prototype=update(Pot.Iter.prototype,{constructor:Pot.Iter,id:Pot.Internal.getMagicNumber(),serial:null,NAME:"Iter",toString:Pot.toString,isIter:Pot.isIter,init:function(args){if(!this.serial){this.serial=buildSerial(this)
}return this},next:function(){throw Pot.StopIteration}});Pot.Iter.prototype.init.prototype=Pot.Iter.prototype;
update(Pot.Iter,{StopIteration:Pot.StopIteration,toIter:function(x){var iter,o,p,v,arrayLike,objectLike;
if(Pot.isIter(x)){return x}arrayLike=x&&Pot.isArrayLike(x);objectLike=x&&!arrayLike&&Pot.isObject(x);
if(objectLike){o=[];for(p in x){try{v=x[p]}catch(e){continue}o[o.length]=[v,p]}}else{o=arrayize(x)
}iter=new Pot.Iter();iter.next=(function(){var i=0;if(objectLike){return function(){var key,val,pair;
while(true){if(i>=o.length){throw Pot.StopIteration}if(!(i in o)){i++;continue}try{key=o[i][1];
val=o[i][0]}catch(e){i++;continue}pair=[val,key];i++;return pair}}}else{return function(){var value,result;
while(true){if(i>=o.length){throw Pot.StopIteration}if(!(i in o)){i++;continue}try{value=o[i]
}catch(e){i++;continue}result=[value,i];i++;return result}}}})();return iter},forEach:function(){return Pot.iterate.apply(null,arguments)
},map:function(object,callback,context){var result,arrayLike,objectLike,iterateDefer,it,iterable;
iterateDefer=this&&this.iterateSpeed;arrayLike=object&&Pot.isArrayLike(object);objectLike=object&&!arrayLike&&Pot.isObject(object);
if(arrayLike){result=[]}else{if(objectLike){result={}}else{result=null}}iterable=iterateDefer||this&&this.iterateSpeedSync||Pot.iterate;
it=function(){return iterable(object,function(val,key,obj){var res=callback.call(context,val,key,obj);
if(arrayLike){result[result.length]=res}else{if(objectLike){result[key]=res}else{result=res
}}},context)};if(iterateDefer){return it().then(function(){return result})}else{it();
return result}},filter:function(object,callback,context){var result,arrayLike,objectLike,iterateDefer,it,iterable;
iterateDefer=this&&this.iterateSpeed;arrayLike=object&&Pot.isArrayLike(object);objectLike=object&&!arrayLike&&Pot.isObject(object);
if(arrayLike){result=[]}else{if(objectLike){result={}}else{result=null}}iterable=iterateDefer||this&&this.iterateSpeedSync||Pot.iterate;
it=function(){return iterable(object,function(val,key,obj){if(callback.call(context,val,key,obj)){if(arrayLike){result[result.length]=val
}else{if(objectLike){result[key]=val}else{result=val}}}},context)};if(iterateDefer){return it().then(function(){return result
})}else{it();return result}},reduce:function(object,callback,initial,context){var arrayLike,objectLike,value,skip,iterateDefer,it,iterable;
iterateDefer=this&&this.iterateSpeed;arrayLike=object&&Pot.isArrayLike(object);objectLike=object&&!arrayLike&&Pot.isObject(object);
if(initial===undefined){value=(function(){var first;if(arrayLike||objectLike){each(object,function(v){first=v;
throw Pot.StopIteration})}return first})()}else{value=initial}skip=true;iterable=iterateDefer||this&&this.iterateSpeedSync||Pot.iterate;
it=function(){return iterable(object,function(val,key,obj){if(skip){skip=false}else{value=callback.call(context,value,val,key,obj)
}},context)};if(iterateDefer){return it().then(function(){return value})}else{it();
return value}},every:function(object,callback,context){var result=true,iterateDefer,it,iterable;
iterateDefer=this&&this.iterateSpeed;iterable=iterateDefer||this&&this.iterateSpeedSync||Pot.iterate;
it=function(){return iterable(object,function(val,key,obj){if(!callback.call(context,val,key,obj)){result=false;
throw Pot.StopIteration}},context)};if(iterateDefer){return it().then(function(){return result
})}else{it();return result}},some:function(object,callback,context){var result=false,iterateDefer,it,iterable;
iterateDefer=this&&this.iterateSpeed;iterable=iterateDefer||this&&this.iterateSpeedSync||Pot.iterate;
it=function(){return iterable(object,function(val,key,obj){if(callback.call(context,val,key,obj)){result=true;
throw Pot.StopIteration}},context)};if(iterateDefer){return it().then(function(){return result
})}else{it();return result}},range:function(){var args=arguments,arg,result;var begin,end,step,n,string,iter;
result=[];begin=0;end=0;step=1;switch(args.length){case 0:return(void 0);case 1:arg=args[0];
if(Pot.isObject(arg)){if("begin" in arg){begin=arg.begin}else{if("start" in arg){begin=arg.start
}}if("end" in arg){end=arg.end}else{if("stop" in arg){end=arg.stop}}if("step" in arg){step=arg.step
}}else{end=arg}break;case 2:begin=args[0];end=args[1];break;case 3:default:begin=args[0];
end=args[1];step=args[2];break}if(Pot.isString(begin)&&begin.length===1&&Pot.isString(end)&&end.length===1){begin=begin.charCodeAt(0)||0;
end=end.charCodeAt(0)||0;string=true}else{begin=begin-0;end=end-0;string=false}step=step-0;
if(isNaN(begin)||isNaN(end)||isNaN(step)||step==0){return result}if((step>0&&begin>end)||(step<0&&begin<end)){n=begin;
begin=end;end=n}iter=new Pot.Iter();iter.next=function(){if((step>0&&begin>end)||(step<0&&begin<end)){throw Pot.StopIteration
}result[result.length]=string?String.fromCharCode(begin):begin;begin+=step};Pot.iterate(iter);
return result},indexOf:function(object,subject,from){var result=-1,arrayLike,objectLike;
var i,len,key,val,args,argn,passed;args=arguments;argn=args.length;arrayLike=object&&Pot.isArrayLike(object);
objectLike=object&&!arrayLike&&Pot.isObject(object);if(arrayLike){try{if(Pot.System.isBuiltinArrayIndexOf){i=Array.prototype.indexOf.apply(object,arrayize(args,1));
if(Pot.isNumeric(i)){result=i}else{throw i}}else{throw i}}catch(err){len=(object&&object.length)||0;
i=Number(from)||0;i=(i<0)?Math.ceil(i):Math.floor(i);if(i<0){i+=len}for(;i<len;i++){try{if(i in object){val=object[i];
if(val===subject){result=i;break}}}catch(e){continue}}}}else{if(objectLike){passed=false;
for(key in object){try{if(!passed&&argn>=3&&from!==key){continue}else{passed=true
}val=object[key];if(val===subject){result=key}}catch(e){continue}}}else{if(object!=null){try{val=(object.toString&&object.toString())||String(object);
result=String.prototype.indexOf.apply(val,arrayize(args,1))}catch(e){result=-1}}else{result=-1
}}}return result},lastIndexOf:function(object,subject,from){var result=-1,arrayLike,objectLike;
var i,len,key,val,args,argn,passed,pairs;args=arguments;argn=args.length;arrayLike=object&&Pot.isArrayLike(object);
objectLike=object&&!arrayLike&&Pot.isObject(object);if(arrayLike){try{if(Pot.System.isBuiltinArrayLastIndexOf){i=Array.prototype.lastIndexOf.apply(object,arrayize(args,1));
if(Pot.isNumeric(i)){result=i}else{throw i}}else{throw i}}catch(err){len=(object&&object.length)||0;
i=Number(from);if(isNaN(i)){i=len-1}else{i=(i<0)?Math.ceil(i):Math.floor(i);if(i<0){i+=len
}else{if(i>=len){i=len-1}}}for(;i>-1;i--){try{if(i in object){val=object[i];if(val===subject){result=i;
break}}}catch(e){continue}}}}else{if(objectLike){pairs=[];passed=false;for(key in object){try{val=object[key]
}catch(e){continue}pairs[pairs.length]=[key,val];if(val===subject){result=key}if(key===from){passed=true;
break}}if(passed){result=-1;len=pairs.length;while(--len>=0){key=pairs[len][0];val=pairs[len][1];
if(val===subject){result=key;break}}}}else{if(object!=null){try{val=(object.toString&&object.toString())||String(object);
result=String.prototype.lastIndexOf.apply(val,arrayize(args,1))}catch(e){result=-1
}}else{result=-1}}}return result}});Pot.update({toIter:Pot.Iter.toIter});update(Pot.tmp,{createIterators:function(iters){each(iters,function(iter){var o={};
o[iter.NAME]=function(){var me={},args=arrayize(arguments);me.iterateSpeed=(this&&this.iterateSpeed)||Pot.Deferred.iterate;
return Pot.Deferred.begin(function(){var d=new Pot.Deferred();iter.method.apply(me,args).then(function(res){d.begin(res)
},function(err){d.raise(err)});return d})};update(Pot.Deferred,o);Pot.Deferred.extendSpeeds(Pot.Deferred,iter.NAME,function(opts){var me={},args=arrayize(arguments,1);
me.iterateSpeed=Pot.Deferred.iterate[opts.speedName];return Pot.Deferred.begin(function(){var d=new Pot.Deferred();
iter.method.apply(me,args).then(function(res){d.begin(res)},function(err){d.raise(err)
});return d})},Pot.Internal.LightIterator.speeds)})},createProtoIterators:function(iters){each(iters,function(iter){var o={},sp={};
o[iter.NAME]=function(){var args=arrayize(arguments),options=update({},this.options);
return this.then(function(value){var d=new Pot.Deferred();args=iter.args(value,args);
iter.method.apply(iter.context,args).ensure(function(res){extendDeferredOptions(d,options);
if(Pot.isError(res)){d.raise(res)}else{d.begin(res)}});return d})};update(Pot.Deferred.fn,o);
if(iter.speed){if(iter.iterable){sp.methods=function(speed){return{iter:iter.iterable[speed],context:iter.context}
}}else{sp.methods=function(speed){return{iter:iter.method,context:{iterateSpeed:iter.context.iterateSpeed[speed]}}
}}Pot.Deferred.extendSpeeds(Pot.Deferred.fn,iter.NAME,function(opts){var that=this,iterable,options,args=arrayize(arguments,1);
iterable=sp.methods(opts.speedName);options=update({},this.options);return this.then(function(value){var d=new Pot.Deferred();
args=iter.args(value,args);iterable.iter.apply(iterable.context,args).ensure(function(res){extendDeferredOptions(d,options);
if(Pot.isError(res)){d.raise(res)}else{d.begin(res)}});return d})},Pot.Internal.LightIterator.speeds)
}})},createSyncIterator:function(creator){var methods,construct;var create=function(speed){var key=speed;
if(!key){each(Pot.Internal.LightIterator.speeds,function(v,k){if(v===Pot.Internal.LightIterator.defaults.speed){key=k;
throw Pot.StopIteration}})}return creator(key)};construct=create();methods={};each(Pot.Internal.LightIterator.speeds,function(v,k){methods[k]=create(k)
});return update(construct,methods)}});Pot.tmp.createIterators([{NAME:"map",method:Pot.Iter.map},{NAME:"filter",method:Pot.Iter.filter},{NAME:"reduce",method:Pot.Iter.reduce},{NAME:"every",method:Pot.Iter.every},{NAME:"some",method:Pot.Iter.some}]);
Pot.tmp.createProtoIterators([{NAME:"forEach",method:Pot.Deferred.forEach,context:null,speed:true,iterable:Pot.Deferred.forEach,args:function(arg,args){return[arg].concat(args)
}},{NAME:"repeat",method:Pot.Deferred.repeat,context:null,speed:true,iterable:Pot.Deferred.repeat,args:function(arg,args){if(Pot.isNumeric(arg)){return[arg-0].concat(args)
}if(arg&&Pot.isNumber(arg.length)){return[arg.length].concat(args)}if(arg&&Pot.isObject(arg)&&("end" in arg||"begin" in arg||"step" in arg||"stop" in arg||"start" in arg)){return[arg].concat(args)
}return args}},{NAME:"forEver",method:Pot.Deferred.forEver,context:null,speed:true,iterable:Pot.Deferred.forEver,args:function(arg,args){return args
}},{NAME:"iterate",method:Pot.Deferred.iterate,context:null,speed:true,iterable:Pot.Deferred.iterate,args:function(arg,args){return[arg].concat(args)
}},{NAME:"map",method:Pot.Iter.map,context:{iterateSpeed:Pot.Deferred.iterate},speed:true,iterable:null,args:function(arg,args){return[arg].concat(args)
}},{NAME:"filter",method:Pot.Iter.filter,context:{iterateSpeed:Pot.Deferred.iterate},speed:true,iterable:null,args:function(arg,args){return[arg].concat(args)
}},{NAME:"reduce",method:Pot.Iter.reduce,context:{iterateSpeed:Pot.Deferred.iterate},speed:true,iterable:null,args:function(arg,args){return[arg].concat(args)
}},{NAME:"every",method:Pot.Iter.every,context:{iterateSpeed:Pot.Deferred.iterate},speed:true,iterable:null,args:function(arg,args){return[arg].concat(args)
}},{NAME:"some",method:Pot.Iter.some,context:{iterateSpeed:Pot.Deferred.iterate},speed:true,iterable:null,args:function(arg,args){return[arg].concat(args)
}}]);Pot.update({map:Pot.tmp.createSyncIterator(function(speedKey){return function(){var context={iterateSpeedSync:Pot.iterate[speedKey]};
return Pot.Iter.map.apply(context,arguments)}}),filter:Pot.tmp.createSyncIterator(function(speedKey){return function(){var context={iterateSpeedSync:Pot.iterate[speedKey]};
return Pot.Iter.filter.apply(context,arguments)}}),reduce:Pot.tmp.createSyncIterator(function(speedKey){return function(){var context={iterateSpeedSync:Pot.iterate[speedKey]};
return Pot.Iter.reduce.apply(context,arguments)}}),every:Pot.tmp.createSyncIterator(function(speedKey){return function(){var context={iterateSpeedSync:Pot.iterate[speedKey]};
return Pot.Iter.every.apply(context,arguments)}}),some:Pot.tmp.createSyncIterator(function(speedKey){return function(){var context={iterateSpeedSync:Pot.iterate[speedKey]};
return Pot.Iter.some.apply(context,arguments)}}),range:function(){return Pot.Iter.range.apply(null,arguments)
},indexOf:function(){return Pot.Iter.indexOf.apply(null,arguments)},lastIndexOf:function(){return Pot.Iter.lastIndexOf.apply(null,arguments)
}});delete Pot.tmp.createIterators;delete Pot.tmp.createProtoIterators;delete Pot.tmp.createSyncIterator;
Pot.update({Serializer:{}});(function(){var NULL,JSONSerializer;if(typeof JSON==="object"&&Pot.isBuiltinMethod(JSON.stringify)&&Pot.isBuiltinMethod(JSON.parse)){update(Pot.Serializer,{serializeToJSON:function(){return JSON.stringify.apply(null,arguments)
},parseFromJSON:function(){return JSON.parse.apply(null,arguments)}});return}NULL="null";
JSONSerializer=update(function(){},{charsCache:{'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\u000B"},replaceTo:/\uFFFF/.test("\uFFFF")?/[\\\"\x00-\x1F\x7F-\uFFFF]/g:/[\\\"\x00-\x1F\x7F-\xFF]/g});
JSONSerializer.prototype=update(JSONSerializer.prototype,{serialize:function(object){var json=[];
this.serializeAll(object,json);return json.join("")},serializeAll:function(object,json){if(object==null){json[json.length]=NULL
}else{switch(Pot.typeOf(object)){case"string":this.serializeString(object,json);break;
case"number":this.serializeNumber(object,json);break;case"boolean":json[json.length]=(object==true)?"true":"false";
break;case"array":this.serializeArray(object,json);break;case"object":case"error":this.serializeObject(object,json);
break;case"date":this.serializeDate(object,json);break;case"regexp":this.serializeString(object.toString(),json);
break;case"function":break;default:json[json.length]=NULL;break}}},padZero:function(n){return(n<10)?"0"+n:n
},serializeDate:function(d,json){var pad=this.padZero;result=isFinite(d.valueOf())?'"'+d.getUTCFullYear()+"-"+pad(d.getUTCMonth()+1)+"-"+pad(d.getUTCDate())+"T"+pad(d.getUTCHours())+":"+pad(d.getUTCMinutes())+":"+pad(d.getUTCSeconds())+'Z"':NULL;
json[json.length]=result},serializeString:function(s,json){var cs=s.replace(JSONSerializer.replaceTo,function(c){var cc,rv;
if(c in JSONSerializer.charsCache){return JSONSerializer.charsCache[c]}cc=c.charCodeAt(0);
rv="\\u";if(cc<16){rv+="000"}else{if(cc<256){rv+="00"}else{if(cc<4096){rv+="0"}}}rv=rv+cc.toString(16);
JSONSerializer.charsCache[c]=rv;return rv});json[json.length]='"'+cs+'"'},serializeNumber:function(n,json){json[json.length]=(isFinite(n)&&!isNaN(n))?n:NULL
},serializeArray:function(a,json){var len,sep="",i,ok,val;len=a&&a.length;json[json.length]="[";
for(i=0;i<len;i++){ok=true;try{val=a[i]}catch(e){ok=false}if(ok){json[json.length]=sep;
this.serializeAll(val,json);sep=","}}json[json.length]="]"},serializeObject:function(o,json){var sep="",key,ok,value;
json[json.length]="{";for(key in o){ok=true;if(hasOwnProperty.call(o,key)){try{value=o[key];
if(Pot.isFunction(value)){throw value}}catch(e){ok=false}if(ok){json[json.length]=sep;
this.serializeString(key,json);json[json.length]=":";this.serializeAll(value,json);
sep=","}}}json[json.length]="}"}});update(Pot.Serializer,{serializeToJSON:function(value){return(new JSONSerializer()).serialize(value)
},parseFromJSON:function(text){var re={meta:/\\["\\\/bfnrtu]/g,string:/"[^"\\\n\r\u2028\u2029\x00-\x08\x10-\x1F\x80-\x9F]*"/g,exprs:/true|false|null|[+-]?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,brackets:/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,remainder:/^[\],:{}\s\u2028\u2029]*$/,space:/^\s*$/,clean:/^(?:[{[(']{0}[')\]}]+|)[;\s\u00A0]*|[;\s\u00A0]*$/g},isValid=function(s){var at="@",bracket="[]".charAt(1);
if(re.space.test(s)){return false}return re.remainder.test(s.replace(re.meta,at).replace(re.string,bracket).replace(re.exprs,bracket).replace(re.brackets,""))
},o=String(text).replace(re.clean,"");if(isValid(o)){return Pot.localEval("("+o+")")
}else{throw new Error("Invalid JSON string: "+o)}}})})();update(Pot.Serializer,{serializeToQueryString:function(params){var queries=[],encode;
if(Pot.isString(params)){return stringify(params)}else{if(!params||params==false){return""
}}if(Pot.isObject(params)||Pot.isArrayLike(params)){encode=Pot.URI.urlEncode;each(params,function(v,k){var item,key,val,sep,ok=true;
item=Pot.isArray(v)?v:[k,v];try{key=stringify(item[0],false);val=stringify(item[1],false)
}catch(e){ok=false}if(ok&&(key||val)){sep=key?"=":"";queries[queries.length]=encode(key)+sep+encode(val)
}})}return queries.join("&")},parseFromQueryString:function(queryString,toObject){var result=[],decode,query,re;
if(Pot.isObject(queryString)||Pot.isArray(queryString)){return queryString}if(toObject){result={}
}query=stringify(queryString,true);if(query){decode=Pot.URI.urlDecode;re=/&(?:(?:amp|#(?:0*38|[xX]0*26));|)/;
while(query.charAt(0)==="?"){query=query.substring(1)}each(query.split(re),function(q){var key,val,pair;
pair=q.split("=");switch(pair.length){case 0:break;case 1:val=pair[0];break;default:key=pair[0];
val=pair[1];break}if(key||val){key=stringify(decode(key));val=stringify(decode(val));
if(toObject){result[key]=val}else{result[result.length]=[key,val]}}})}return result
}});Pot.update({serializeToJSON:Pot.Serializer.serializeToJSON,parseFromJSON:Pot.Serializer.parseFromJSON,serializeToQueryString:Pot.Serializer.serializeToQueryString,parseFromQueryString:Pot.Serializer.parseFromQueryString});
Pot.update({URI:{}});update(Pot.URI,{urlEncode:update(function(string){var result="",me=arguments.callee,s;
s=stringify(string,true);if(s){if(Pot.isPercentEncoded(s)){result=s}else{try{result=me.encoder.component(s)
}catch(e){result=me.encoder.encode(s)}}}return stringify(result,true)},{encoder:{component:function(string){return encodeURIComponent(string)
},encode:function(string){var result="",s,re,rep,per;s=stringify(string,true);if(s){re=/[^!'-*.0-9A-Z_a-z~-]/g;
per="%";rep=function(s){var r,c=s.charCodeAt(0);if(c<16){r=per+"0"+c.toString(16)
}else{if(c<128){r=per+c.toString(16)}else{if(c<2048){r=per+(c>>6|192).toString(16)+per+(c&63|128).toString(16)
}else{r=per+(c>>12|224).toString(16)+per+(c>>6&63|128).toString(16)+per+(c&63|128).toString(16)
}}}return r.toUpperCase()};result=s.replace(re,rep)}return result}}}),urlDecode:update(function(string){var result="",me=arguments.callee,s;
s=stringify(string,true);if(s){s=s.replace(me.decoder.reSpace.from,me.decoder.reSpace.to);
try{result=me.decoder.component(s)}catch(e){result=me.decoder.decode(s)}}return stringify(result,true)
},{decoder:{reSpace:{from:/[+]/g,to:" "},component:function(string){return decodeURIComponent(string)
},decode:function(string){var result="",s,re,rep;s=stringify(string,true);if(s){re=new RegExp(["%","(?:","E","(?:","0%[AB]","|","[1-CEF]%[89AB]","|","D%[89]",")","[0-9A-F]","|","C[2-9A-F]","|","D[0-9A-F]",")","%[89AB][0-9A-F]","|","%[0-7][0-9A-F]"].join(""),"gi");
rep=function(s){var r,c=parseInt(s.substring(1),16);if(c<128){r=c}else{if(c<224){r=((c&31)<<6|parseInt(s.substring(4),16)&63)
}else{r=(((c&15)<<6|parseInt(s.substring(4),16)&63)<<6|parseInt(s.substring(7),16)&63)
}}return String.fromCharCode(r)};result=s.replace(re,rep)}return result}}})});Pot.update({urlEncode:Pot.URI.urlEncode,urlDecode:Pot.URI.urlDecode});
Pot.update({Crypt:{}});update(Pot.Crypt,{hashCode:function(string){var result=0,s,i,len,max;
max=4294967296;if(string==null){s=String(string)}else{s=string.toString?string.toString():String(string)
}len=s.length;for(i=0;i<len;++i){result=31*result+s.charCodeAt(i);result%=max}return result
}});Pot.update({hashCode:Pot.Crypt.hashCode});(function(){Pot.update({Net:{}});update(Pot.Net,{request:function(url,options){if(Pot.System.isGreasemonkey){return Pot.Net.requestByGreasemonkey(url,options)
}else{if(Pot.System.isNodeJS){return Pot.Net.requestByNodeJS(url,options)}else{return Pot.Net.XHR.request(url,options)
}}},XHR:{ReadyState:{UNINITIALIZED:0,LOADING:1,LOADED:2,INTERACTIVE:3,COMPLETE:4},factory:function(){var x,xhr;
if(Pot.System.isNodeJS){try{xhr=require("XMLHttpRequest").XMLHttpRequest;x=new xhr
}catch(e){}}if(!x){try{x=new XMLHttpRequest()}catch(e){}if(!x&&Pot.System.hasActiveXObject){each(["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],function(prog){try{x=new ActiveXObject(prog)
}catch(e){}if(x){throw Pot.StopIteration}})}}return x},request:(function(){var Request=function(url,options){return new Request.prototype.doit(url,options)
};Request.prototype=update(Request.prototype,{xhr:null,url:null,options:{},deferred:null,doit:function(url,options){var that=this;
this.url=stringify(url,true);this.deferred=new Pot.Deferred({canceller:function(){try{that.cancel(true)
}catch(e){}}});if(this.url){try{this.setOptions(options);if(this.factory()){this.open();
this.setHeaders();this.setReadyStateChange();this.send()}}catch(e){try{this.cancel(true)
}catch(ex){}this.deferred.raise(e)}}return this},factory:function(){this.xhr=Pot.Net.XHR.factory();
if(!this.xhr){this.deferred.raise("Failed to create XMLHttpRequest");return false
}else{return true}},setOptions:function(options){var query,defaults,opts;defaults={method:"GET",sendContent:null,queryString:null,callback:null,username:null,password:null,headers:null,mimeType:null};
if(Pot.isObject(options)){opts=update({},options)}else{opts={}}this.options=update({},defaults,opts||{});
this.method=trim(this.options.method).toUpperCase();if(!this.method){this.method=defaults.method
}this.url=buildURL(this.url,this.options.queryString);this.options.sendContent=stringify(Pot.Serializer.serializeToQueryString(this.options.sendContent),true);
if((this.options.method==="GET"||this.options.method===defaults.method)&&(this.options.sendContent)){this.options.method="POST"
}},open:function(){if(this.options.username!=null){this.xhr.open(this.options.method,this.url,true,stringify(this.options.username,true),stringify(this.options.password,true))
}else{this.xhr.open(this.options.method,this.url,true)}},setHeaders:function(){var that=this,contentType;
try{try{if(this.xhr.overrideMimeType&&this.options.mimeType!=null){this.xhr.overrideMimeType(this.options.mimeType)
}}catch(e){}this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");if(this.options.contentType!=null){contentType=this.options.contentType
}if(this.options.headers!=null){each(this.options.headers,function(value,name){if(!contentType&&/^Content-?Type/i.test(name)){contentType=value
}else{that.xhr.setRequestHeader(name,value)}})}if(!contentType&&this.options.method==="POST"){contentType="application/x-www-form-urlencoded"
}if(contentType){this.xhr.setRequestHeader("Content-Type",contentType)}}catch(e){}},setReadyStateChange:function(){var that=this;
this.xhr.onreadystatechange=function(){var status=null;if(that.xhr.readyState==Pot.Net.XHR.ReadyState.COMPLETE){that.cancel();
try{status=parseInt(that.xhr.status);if(!status&&that.xhr.responseText){status=304
}}catch(e){}if((status>=200&&status<300)||status===304||status===1223){if(Pot.isFunction(that.options.callback)){Pot.Deferred.flush(function(){that.options.callback.call(that.xhr,that.xhr.responseText,that.xhr)
}).ensure(function(res){that.deferred.begin(that.xhr)})}else{that.deferred.begin(that.xhr)
}}else{that.deferred.raise(update({},that.xhr));try{that.cancel(true)}catch(e){}}}}
},cancel:function(isAbort){try{this.xhr.onreadystatechange=null}catch(e){try{this.xhr.onreadystatechange=Pot.noop
}catch(e){}}if(isAbort){try{this.xhr.abort()}catch(e){}}},send:function(){this.xhr.send(this.options.sendContent);
this.deferred.data({request:this.xhr})}});Request.prototype.doit.prototype=Request.prototype;
return function(url,options){return(new Request(url,options)).deferred}})()},requestByGreasemonkey:function(url,options){var d,opts,maps,type;
d=new Pot.Deferred();opts=update({},options||{});maps={sendContent:"data",mimeType:"overrideMimeType",username:"user"};
each(maps,function(gm,org){if(org in opts){opts[gm]=opts[org]}});opts.method=trim(opts.method).toUpperCase()||"GET";
opts.url=buildURL(url,opts.queryString);if(opts.data){opts.data=Pot.Serializer.serializeToQueryString(opts.data)
}if(opts.data&&opts.method==="GET"){opts.method="POST"}type=opts.contentType;if(opts.headers){each(opts.headers,function(v,k){if(!type&&/^Content-?Type/i.test(k)){type=v;
throw Pot.StopIteration}})}if(!type&&opts.method==="POST"){type="application/x-www-form-urlencoded"
}if(type){opts.headers=update(opts.headers||{},{"Content-Type":type})}if(opts.onload){d.then(opts.onload)
}if(opts.onerror){d.rescue(opts.onerror)}update(opts,{onload:function(){d.begin.apply(d,arguments)
},onerror:function(){d.raise.apply(d,arguments)}});Pot.Deferred.callLazy(function(){var req=GM_xmlhttpRequest(opts);
d.data({request:req});d.canceller(function(){try{req.abort()}catch(e){}})});return d
},requestByNodeJS:(function(){function SimpleRequestByNode(options){return new SimpleRequestByNode.prototype.doit(options)
}function SimpleResponseByNode(res){return new SimpleResponseByNode.prototype.init(res)
}SimpleResponseByNode.prototype=update(SimpleResponseByNode.prototype,{responseText:"",responseXML:"",status:null,statusText:null,init:function(response){var res=response||{};
update(this,res,{getResponseHeader:this.getResponseHeader,getAllResponseHeaders:this.getAllResponseHeaders,responseText:res.responseText,responseXML:res.responseXML,status:res.status,statusText:res.statusText});
return this},getResponseHeader:function(name){var result=null,key;key=stringify(name);
lkey=key.toLowerCase();if(this.headers){if(lkey in this.headers){result=this.headers[lkey]
}else{if(key in this.headers){result=this.headers[key]}}}return result},getAllResponseHeaders:function(){var results=[],key;
if(this.headers){for(key in this.headers){results.push(key+": "+this.headers[key])
}}return results.join("\r\n")}});SimpleRequestByNode.prototype=update(SimpleRequestByNode.prototype,{deferred:null,request:null,response:null,headers:{},requestOptions:{},defaultHeaders:{Accept:"*/*","User-Agent":["Pot.js/",Pot.VERSION," ",Pot.TYPE," ","(Node.js; *)"].join("")},doit:function(options){var that=this;
this.deferred=new Pot.Deferred({canceller:function(){try{that.abort()}catch(e){}}});
this.setOptions(options);this.send();return this},setOptions:function(options){var opts,method,ssl,uri,host,port,path,auth,data;
opts=update({},options||{});method=trim(opts.method).toUpperCase()||"GET";ssl=false;
uri=require("url").parse(opts.url);switch(uri.protocol){case"https:":ssl=true;case"http:":host=uri.hostname;
break;default:throw new Error("Not supported protocol: "+uri.protocol)}port=uri.port||(ssl?443:80);
path=uri.pathname+(uri.search?uri.search:"");this.headers=update({},this.defaultHeaders,opts.headers||{});
this.headers.Host=host;if(opts.username!=null){auth=new Buffer([stringify(opts.username,true),stringify(opts.password,true)].join(":"));
this.headers.Authorization="Basic "+auth.toString("base64")}if(method==="GET"||method==="HEAD"){data=null
}else{if(data){this.headers["Content-Length"]=Buffer.byteLength(data);if(!this.headers["Content-Type"]){this.headers["Content-Type"]="text/plain;charset=UTF-8"
}}}this.requestOptions={data:data,ssl:ssl,settings:{host:host,port:port,path:path,method:method,headers:this.headers}}
},send:function(){var that=this,doRequest;if(this.requestOptions.ssl){doRequest=require("https").request
}else{doRequest=require("http").request}this.request=doRequest(this.requestOptions.settings,function(res){that.response=new SimpleResponseByNode(res);
that.response.responseText="";that.response.responseXML="";that.response.setEncoding("utf8");
that.response.status=that.response.statusCode;if(that.response.status==200&&!that.response.statusText){that.response.statusText="OK"
}that.response.on("data",function(chunk){if(chunk){that.response.responseText+=stringify(chunk,true)
}});that.response.on("end",function(){that.deferred.begin(that.response)});that.response.on("error",function(err){that.handleError(err)
})}).on("error",function(err){that.handleError(err)});if(this.requestOptions.data){this.request.write(this.requestOptions.data)
}this.request.end()},handleError:function(error){this.response.status=503;this.response.statusText=error;
this.response.responseText=error&&error.stack;this.deferred.raise(this.response)},abort:function(){if(this.response){this.response.responseText="";
this.response.responseXML=""}try{if(this.request&&this.request.abort){this.request.abort()
}}catch(e){}}});SimpleRequestByNode.prototype.doit.prototype=SimpleRequestByNode.prototype;
SimpleResponseByNode.prototype.init.prototype=SimpleResponseByNode.prototype;return function(url,options){var opts=update({},options||{},{url:url});
return(new SimpleRequestByNode(opts)).deferred}})(),requestByJSONP:(function(){var PATTERNS={KEY:/json|call/i,DONE:/loaded|complete/};
return function(url,options){var d,opts,context,id,callback,key;var doc,uri,head,script,done,defaults;
defaults="callback";d=new Pot.Deferred();opts=update({},options||{});context=globals||Pot.Global;
doc=getDoc();head=getHead(doc);if(!context||!doc||!head||!url){return d.raise(context||url||head||doc)
}try{if(opts.callback){if(Pot.isString(opts.callback)){id=opts.callback}else{if(Pot.isFunction(opts.callback)){callback=opts.callback
}else{if(Pot.isObject(opts.callback)){for(key in opts.callback){defaults=key;if(Pot.isString(opts.callback[key])){id=opts.callback[key]
}else{if(Pot.isFunction(opts.callback[key])){callback=opts.callback[key]}}break}}}}}else{each(opts,function(v,k){if(PATTERNS.KEY.test(k)){defaults=k;
if(Pot.isString(v)){id=v}else{if(Pot.isFunction(v)){callback=v}}throw Pot.StopIteration
}})}if(!id){do{id=buildSerial(Pot,"")}while(id in context)}uri=buildURL(insertId(url,id,defaults),opts.queryString||opts.sendContent);
if(Pot.System.isGreasemonkey){return Pot.Net.requestByGreasemonkey(uri,{method:"GET"}).then(function(res){var code=trim(res&&res.responseText);
code=code.replace(/^[^{]*|[^}]*$/g,"");return Pot.Serializer.parseFromJSON(code)})
}script=doc.createElement("script");script.async="async";if(opts.type){script.type=opts.type
}if(opts.charset){script.charset=opts.charset}context[id]=function(){var args=arguments;
try{delete context[id]}catch(e){try{context[id]=null}catch(e){}}try{if(script){script.parentNode.removeChild(script)
}script=undefined}catch(e){}if(Pot.isFunction(callback)){callback.apply(callback,args)
}d.begin.apply(d,args)};script.src=uri;script.onload=script.onreadystatechange=function(a,isAbort){if(!done&&script&&(isAbort===1||!script.readyState||PATTERNS.DONE.test(script.readyState))){done=true;
try{script.onload=script.onreadystatechange=null}catch(e){}if(head&&script&&script.parentNode){try{head.removeChild(script)
}catch(e){}}script=undefined}};d.canceller(function(){try{if(script){script.onload(0,1)
}}catch(e){}});head.insertBefore(script,head.firstChild)}catch(e){d.raise(e)}return d
}})()});function buildURL(url,query){var u,q,p;u=stringify(url);p=(~u.indexOf("?"))?"&":"?";
q=stringify(Pot.Serializer.serializeToQueryString(query));while(u.slice(-1)===p){u=u.slice(0,-1)
}while(q.charAt(0)===p){q=q.substring(1)}if(q){q=p+q}return u?u+q:null}function getDoc(){var doc;
try{if(typeof document!=="undefined"&&Pot.isDocument(document)){doc=document}else{if(Pot.isDocument(globals)){doc=globals
}else{if(Pot.isDocument(Pot.Global)){doc=Pot.Global}else{if(globals&&Pot.isDocument(globals.document)){doc=globals.document
}else{if(Pot.Global&&Pot.isDocument(Pot.Global.document)){doc=Pot.Global.document
}else{if(globals&&globals.content&&Pot.isDocument(globals.content.document)){doc=globals.content.document
}else{if(Pot.Global&&Pot.Global.content&&Pot.isDocument(Pot.Global.content.document)){doc=Pot.Global.content.document
}}}}}}}}catch(e){doc=null}return doc}function getHead(doc){var context=doc;try{if(!context){context=getDoc()
}return(Pot.isElement(doc.head)&&doc.head)||doc.getElementsByTagName("head")[0]||doc.documentElement
}catch(e){}}function insertId(url,id,defaults){var uri=stringify(url);if(~uri.indexOf("=?")){uri=uri.replace("=?","="+id)
}else{if(~uri.indexOf("?")){uri=uri.replace("?","?"+defaults+"="+id)}else{while(uri.slice(-1)==="&"){uri=uri.slice(0,-1)
}uri=uri+"?"+defaults+"="+id}}return uri}Pot.update({request:Pot.Net.request,jsonp:Pot.Net.requestByJSONP})
})();Pot.update({XPCOM:{}});update(Pot.XPCOM,{evalInSandbox:function(code,url){var result,re,src;
if(Pot.System.hasComponents){if(!Cu){Pot.System.isWaitable=Pot.System.hasComponents=false;
return}re=/^[\s;]*|[\s;]*$/g;src=["(",")"].join(stringify(code).replace(re,""));result=Cu.evalInSandbox(src,Cu.Sandbox(url))
}return result},throughout:function(cond){var thread;if(Pot.System.hasComponents){try{thread=Cc["@mozilla.org/thread-manager;1"].getService(Ci.nsIThreadManager).mainThread
}catch(e){Pot.System.isWaitable=Pot.System.hasComponents=false}if(thread&&Pot.System.hasComponents){do{thread.processNextEvent(true)
}while(cond&&!cond())}}},getMostRecentWindow:function(){var cwin;if(Pot.System.hasComponents){try{cwin=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator).getMostRecentWindow("navigator:browser")
}catch(e){Pot.System.isWaitable=Pot.System.hasComponents=false}}return cwin},getChromeWindow:function(uri){var result,win,wins,pref;
if(!Pot.System.hasComponents){return}pref=uri||"chrome://browser/content/browser.xul";
try{wins=Cc["@mozilla.org/appshell/window-mediator;1"].getService(Ci.nsIWindowMediator).getXULWindowEnumerator(null)
}catch(e){Pot.System.isWaitable=Pot.System.hasComponents=false;return}while(wins.hasMoreElements()){try{win=wins.getNext().QueryInterface(Ci.nsIXULWindow).docShell.QueryInterface(Ci.nsIInterfaceRequestor).getInterface(Ci.nsIDOMWindow);
if(win&&win.location&&(win.location.href==pref||win.location==pref)){result=win;break
}}catch(e){}}return result}});Pot.update({Debug:{}});update(Pot.Debug,{debug:debug});
Pot.update({globalize:function(target,advised){var result=false,args=arrayize(arguments);
var inputs,outputs,len,noops=[];len=args.length;if(len<=1&&this===Pot&&!Pot.isObject(target)){inputs=this;
if(len>=1&&Pot.isBoolean(target)){advised=target}else{advised=!!target}}else{if(target&&(Pot.isObject(target)||Pot.isFunction(target)||Pot.isArray(target))){inputs=target
}}outputs=Pot.Internal.getExportObject(true);if(inputs&&outputs){if(inputs===Pot){if(Pot.Internal.exportPot&&Pot.Internal.PotExportProps){result=Pot.Internal.exportPot(advised,true)
}}else{each(inputs,function(prop,name){if(advised&&name in outputs){noops[noops.length]=name
}else{outputs[name]=prop}});result=noops}}return result}});update(Pot.Internal,{exportPot:function(advised,forGlobalScope,initialize){var outputs,noops=[];
outputs=Pot.Internal.getExportObject(forGlobalScope);if(outputs){each(Pot.Internal.PotExportProps,function(prop,name){if(advised&&name in outputs){noops[noops.length]=name
}else{outputs[name]=prop}})}if(initialize){if(Pot.System.isWebBrowser){outputs=Pot.Internal.getExportObject(true);
if(outputs&&outputs.Pot!==Pot){update(outputs,{Pot:Pot})}}}return noops},PotExportProps:{Pot:Pot,update:update,isBoolean:Pot.isBoolean,isNumber:Pot.isNumber,isString:Pot.isString,isFunction:Pot.isFunction,isArray:Pot.isArray,isDate:Pot.isDate,isRegExp:Pot.isRegExp,isObject:Pot.isObject,isError:Pot.isError,typeOf:Pot.typeOf,typeLikeOf:Pot.typeLikeOf,StopIteration:Pot.StopIteration,isStopIter:Pot.isStopIter,isIterable:Pot.isIterable,isArrayLike:Pot.isArrayLike,isDeferred:Pot.isDeferred,isIter:Pot.isIter,isPercentEncoded:Pot.isPercentEncoded,isNumeric:Pot.isNumeric,isInt:Pot.isInt,isNativeCode:Pot.isNativeCode,isBuiltinMethod:Pot.isBuiltinMethod,isWindow:Pot.isWindow,isDocument:Pot.isDocument,isElement:Pot.isElement,isNodeLike:Pot.isNodeLike,isNodeList:Pot.isNodeList,Deferred:Pot.Deferred,succeed:Pot.Deferred.succeed,failure:Pot.Deferred.failure,wait:Pot.Deferred.wait,callLater:Pot.Deferred.callLater,callLazy:Pot.Deferred.callLazy,maybeDeferred:Pot.Deferred.maybeDeferred,isFired:Pot.Deferred.isFired,lastResult:Pot.Deferred.lastResult,lastError:Pot.Deferred.lastError,register:Pot.Deferred.register,unregister:Pot.Deferred.unregister,deferrize:Pot.Deferred.deferrize,begin:Pot.Deferred.begin,flush:Pot.Deferred.flush,till:Pot.Deferred.till,parallel:Pot.Deferred.parallel,chain:Pot.Deferred.chain,forEach:Pot.forEach,repeat:Pot.repeat,forEver:Pot.forEver,iterate:Pot.iterate,Iter:Pot.Iter,toIter:Pot.Iter.toIter,map:Pot.map,filter:Pot.filter,reduce:Pot.reduce,every:Pot.every,some:Pot.some,range:Pot.range,indexOf:Pot.indexOf,lastIndexOf:Pot.lastIndexOf,globalEval:Pot.globalEval,localEval:Pot.localEval,serializeToJSON:Pot.Serializer.serializeToJSON,parseFromJSON:Pot.Serializer.parseFromJSON,serializeToQueryString:Pot.Serializer.serializeToQueryString,parseFromQueryString:Pot.Serializer.parseFromQueryString,urlEncode:Pot.URI.urlEncode,urlDecode:Pot.URI.urlDecode,request:Pot.Net.request,jsonp:Pot.Net.requestByJSONP,rescape:rescape,arrayize:arrayize,invoke:invoke,stringify:stringify,trim:trim,now:now,hashCode:Pot.Crypt.hashCode,globalize:Pot.globalize,debug:Pot.Debug.debug}});
Pot.update({deferrizejQueryAjax:(function(){if(typeof jQuery!=="function"||!jQuery.fn){return Pot.noop
}return function(){return(function($){var orgAjax=$.ajax;$.pot=Pot;$.fn.extend({deferred:function(method){var func,args=arrayize(arguments,1),exists=false;
each(args,function(arg){if(Pot.isFunction(arg)){exists=true;throw Pot.StopIteration
}});if(!exists){args.push(function(){return arrayize(arguments)})}func=Pot.Deferred.deferrize(method,this);
return func.apply(this,args)}});$.ajax=function(options){var d=new Pot.Deferred(),opts,orgs,er;
opts=update({},options||{});orgs=update({},opts);update(opts,{success:function(){var args=arrayize(arguments),err,done;
try{if(orgs.success){orgs.success.apply(this,args)}}catch(e){done=true;err=e||new Error(e);
args.push(err);d.raise.apply(d,args)}if(!done){d.destassign=true;d.begin.apply(d,args)
}},error:function(){var args=arrayize(arguments),err;try{if(orgs.error){orgs.error.apply(this,args)
}}catch(e){err=e||new Error(e);args.unshift(err)}finally{d.raise.apply(d,args)}}});
try{d.data({result:orgAjax(opts)})}catch(e){er=e;d.raise(er)}return d}})(jQuery)}
})()});Pot.Internal.exportPot(false,false,true)})(this||{});
